
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Laurent Kempé">
    <title>WPF and .NET Generic Host with .NET Core 3.0 - Laurent Kempé</title>
    <meta name="author" content="Laurent Kempé">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Laurent Kempé","sameAs":["https://github.com/laurentkempe","https://twitter.com/laurentkempe","https://www.linkedin.com/in/laurentkempe","https://flickr.com/photos/laurentkempe/"],"image":"https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg"},"articleBody":"I like very much the idea of a .NET Generic Host in the MSDN documentation:\n\nAn object that encapsulates an app’s resources, such as:\n\nDependency injection (DI)\nLogging\nConfiguration\nIHostedService implementations\n\n\n\n\nThe origin of .NET Generic Host is Microsoft.Extensions, a set of .NET APIs for commonly used programming patterns and utilities, such as dependency injection, logging, and application configuration.\nWhy do I like this idea? Because it means that whatever application you are building using .NET Generic Host, it will always bring all of those services freely in a consistent manner. The application can be an ASP.NET Core application, which is where the idea of Web Host emerged and was refined into a Generic Host.\nBut, why couldn’t a WPF application be build using it? The current WPF template doesn’t use .NET Generic Host! Never the less, let’s modify the code generated by the WPF template to leverage it.\nThe goal is to have a tiny .NET Core 3.0 WPF application demonstrating each of Dependency injection (DI), Logging and Configuration.\nDefault WPF templateWe need to modify the App.xaml so that it doesn’t use StartupUri. Which sets the UI; MainWindow.xaml, that is automatically shown when an application starts. Our goal is to be able to create the Window ourself, using the IOC container, so that we can inject services!\nWe replace StartupUri by Startup calling Application_Startup and when we are at it, we also add Exit and Application_Exit. This will let us know when the application starts/stops so that we can start/stop the host.\nApp.xaml1&lt;Application x:Class=\"wpfGenericHost.App\"2             xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"3             xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"4             xmlns:local=\"clr-namespace:wpfGenericHost\"5             Startup=\"Application_Startup\"6             Exit=\"Application_Exit\"&gt;7    &lt;Application.Resources /&gt;         8&lt;/Application&gt;\n\nApp.xaml.cs1public partial class App : Application2&#123;3    public App()4    &#123;5    &#125;67    private void Application_Startup(object sender, StartupEventArgs e)8    &#123;9    &#125;1011    private void Application_Exit(object sender, ExitEventArgs e)12    &#123;13    &#125;14&#125;\n\nThe App constructor seems to be the right place to build our new Host. Application_Startup the place to start the host and Application_Exit the place to stop the host.\nApp.xaml.cs1public partial class App : Application2&#123;3    private IHost _host;45    public App()6    &#123;7        _host = new HostBuilder().Build();8    &#125;910    private async void Application_Startup(object sender, StartupEventArgs e)11    &#123;12        await _host.StartAsync();13    &#125;1415    private async void Application_Exit(object sender, ExitEventArgs e)16    &#123;17        using (_host)18        &#123;19            await _host.StopAsync(TimeSpan.FromSeconds(5));20        &#125;21    &#125;22&#125;\n\nDependency injection (DI)A first capability that .NET Generic Host is bringing is Dependency injection. We can inject some dependencies to the MainWindow as we delegate it’s creation to the IOC container in Application_Startup. In this example, we are injecting a simple interface called ITextService with one method GetText().\nIn a real application, we definitely would be able to inject a View Model like MainWindowViewModel which would itself have other dependencies provided by the IOC container.\n\n\nMainWindow.xaml.cs1public partial class MainWindow : Window2&#123;3    public MainWindow(ITextService textService)4    &#123;5        InitializeComponent();67        Label.Content = textService.GetText();8    &#125;9&#125;\n\nApp.xaml.cs1public partial class App : Application2&#123;3    private IHost _host;45    public App()6    &#123;7        _host = new HostBuilder()8                    .ConfigureServices((context, services) =&gt;9                    &#123;10                        services.AddSingleton&lt;ITextService, TextService&gt;();11                        services.AddSingleton&lt;MainWindow&gt;();12                    &#125;)13                    .Build();14    &#125;1516    private async void Application_Startup(object sender, StartupEventArgs e)17    &#123;18        await _host.StartAsync();1920        var mainWindow = _host.Services.GetService&lt;MainWindow&gt;();21        mainWindow.Show();22    &#125;2324    ...25&#125;\n\nConfigurationThe second capability of .NET Generic Host we want to explore is Configuration. We want to build the concrete implementation of ITextService with a dependency on an external configuration to get the text to display in the main window.\nThe configuration is handled by a concrete class called Settings and the appsettings.json configuration file. Both have a property called Text.\nSettings.cs1public class Settings2&#123;3    public string Text &#123; get; set; &#125;4&#125;\n\nappsettings.json1&#123;2    \"Text\": \"Hello WPF .NET Core 3.0\\nfrom .NET Generic Host!\"3&#125;\n\nTextService.cs1class TextService : ITextService2&#123;3    private string _text;45    public TextService(IOptions&lt;Settings&gt; options)6    &#123;7        _text = options.Value.Text;8    &#125;910    public string GetText()11    &#123;12        return _text;13    &#125;14&#125;\n\nWe register the Settings class in the IOC container so that it is resolved and injected as IOptions in our concrete class TextService.\nApp.xaml.cs1public partial class App : Application2&#123;3    private IHost _host;4    private readonly Settings _settings;567    public App()8    &#123;9        _host = new HostBuilder()10                    .ConfigureAppConfiguration((context, configurationBuilder) =&gt;11                    &#123;12                        configurationBuilder.SetBasePath(context.HostingEnvironment.ContentRootPath);13                        configurationBuilder.AddJsonFile(\"appsettings.json\", optional: false);14                    &#125;)15                    .ConfigureServices((context, services) =&gt;16                    &#123;17                        services.Configure&lt;Settings&gt;(context.Configuration);1819                        services.AddSingleton&lt;ITextService, TextService&gt;();20                        services.AddSingleton&lt;MainWindow&gt;();21                    &#125;)22                    .Build();23    &#125;24    ...25&#125;\n\nLoggingThe final capability of .NET Generic Host we want to have a look at is Logging. In our simple example, we will just add the possibility to output logs to the Console. Again, we are injecting an ILogger into our concrete class TextService to be able to write a piece of information to our logs.\nTextService.cs1class TextService : ITextService2&#123;3    private string _text;45    public TextService(IOptions&lt;Settings&gt; options, ILogger&lt;TextService&gt; logger)6    &#123;7        _text = options.Value.Text;89        logger.LogInformation($\"Text read from settings: '&#123;options.Value.Text&#125;'\");10    &#125;1112    public string GetText()13    &#123;14        return _text;15    &#125;16&#125;\n\nApp.xaml.cs1public partial class App : Application2&#123;3    private IHost _host;45    public App()6    &#123;7        _host = new HostBuilder()8                    .ConfigureAppConfiguration((context, configurationBuilder) =&gt;9                    &#123;10                        configurationBuilder.SetBasePath(context.HostingEnvironment.ContentRootPath);11                        configurationBuilder.AddJsonFile(\"appsettings.json\", optional: false);12                    &#125;)13                    .ConfigureServices((context, services) =&gt;14                    &#123;15                        services.Configure&lt;Settings&gt;(context.Configuration);1617                        services.AddSingleton&lt;ITextService, TextService&gt;();18                        services.AddSingleton&lt;MainWindow&gt;();19                    &#125;)20                    .ConfigureLogging(logging =&gt;21                    &#123;22                        logging.AddConsole();23                    &#125;)24                    .Build();25    &#125;26    ...27&#125;\n\nResultWe can run the application and see that MainWindow is created using the TextService which read the Text property of appsettings.json and our WPF application correctly displays the text.\n\nAnd the output in the log\n\nConclusionWe have seen all the benefits the .NET Generic Host is bringing. It was easy to integrate into WPF applications, even if Microsoft is not currently providing a .NET Core template for that particular usage. But it seems that the idea is open to discussion, you can read more about it on Github issue “Make Future WPF IoC Friendly #499“.\nYou can get all the code on GitHub \n\n  \n\n\n\n","dateCreated":"2019-09-03T20:21:08+00:00","dateModified":"2020-04-23T06:42:15+00:00","datePublished":"2019-09-03T20:21:08+00:00","description":"I like very much the idea of a .NET Generic Host in the MSDN documentation:\n\nAn object that encapsulates an app’s resources, such as:\n\nDependency injection (DI)\nLogging\nConfiguration\nIHostedService implementations\n\n","headline":"WPF and .NET Generic Host with .NET Core 3.0","image":["https://live.staticflickr.com/65535/46849236405_eed5de84f0_q.jpg","https://live.staticflickr.com/65535/46849236405_4ce597fca2_h.jpg"],"mainEntityOfPage":{"@type":"WebPage","@id":"/https:/laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/"},"publisher":{"@type":"Organization","name":"Laurent Kempé","sameAs":["https://github.com/laurentkempe","https://twitter.com/laurentkempe","https://www.linkedin.com/in/laurentkempe","https://flickr.com/photos/laurentkempe/"],"image":"https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg","logo":{"@type":"ImageObject","url":"https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg"}},"url":"/https:/laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/","keywords":".NET Core, WPF","thumbnailUrl":"https://live.staticflickr.com/65535/46849236405_eed5de84f0_q.jpg"}</script>
    <meta name="description" content="I like very much the idea of a .NET Generic Host in the MSDN documentation:  An object that encapsulates an app’s resources, such as:  Dependency injection (DI) Logging Configuration IHostedService im">
<meta name="keywords" content=".NET Core,WPF">
<meta property="og:type" content="blog">
<meta property="og:title" content="WPF and .NET Generic Host with .NET Core 3.0">
<meta property="og:url" content="https:&#x2F;&#x2F;laurentkempe.com&#x2F;2019&#x2F;09&#x2F;03&#x2F;WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0&#x2F;index.html">
<meta property="og:site_name" content="Laurent Kempé">
<meta property="og:description" content="I like very much the idea of a .NET Generic Host in the MSDN documentation:  An object that encapsulates an app’s resources, such as:  Dependency injection (DI) Logging Configuration IHostedService im">
<meta property="og:locale" content="en">
<meta property="og:image" content="https:&#x2F;&#x2F;live.staticflickr.com&#x2F;65535&#x2F;48673324906_115675602b_o.png%22">
<meta property="og:image" content="https:&#x2F;&#x2F;live.staticflickr.com&#x2F;65535&#x2F;48673362031_ab8e1f486b_o.png">
<meta property="og:updated_time" content="2020-04-23T06:42:15.381Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;live.staticflickr.com&#x2F;65535&#x2F;48673324906_115675602b_o.png%22">
<meta name="twitter:creator" content="@laurentkempe">
    
    
        
    
    
        <meta property="og:image" content="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg"/>
    
    
        <meta property="og:image" content="https://live.staticflickr.com/65535/46849236405_eed5de84f0_q.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://live.staticflickr.com/65535/46849236405_eed5de84f0_q.jpg"/>
    
    
        <meta property="og:image" content="https://live.staticflickr.com/65535/46849236405_4ce597fca2_h.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://live.staticflickr.com/65535/46849236405_4ce597fca2_h.jpg"/>
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-ntj7mgt3iinduprr9o7hsjlwwzhympaybswme78hbuuhpoo3w8vsmz9z3zxd.min.css">
    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-64298-8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-64298-8');
    </script>


    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Laurent Kempé
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="global.open_link: /#about"
            >
        
        
            <img class="header-picture" src="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="global.read_more_about_author"
                >
                    <img class="sidebar-profile-picture" src="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Laurent Kempé</h4>
                
                    <h5 class="sidebar-profile-bio"><p>I am an experienced Team Leader &amp; Senior Solutions Architect with a passion for shipping high-quality products by empowering development team and culture toward an agile mindset. I bring technical vision and strategy, leading engineering teams to move product, processes and architecture forward.</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/"
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="Archives"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/presentations.html"
                            
                            title="Presentations"
                        >
                    
                        <i class="sidebar-button-icon fa fa-file-powerpoint" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Presentations</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/about-laurent-kempe.html"
                            
                            title="About"
                        >
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/laurentkempe" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://twitter.com/laurentkempe" target="_blank" rel="noopener" title="Twitter">
                    
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/laurentkempe" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://flickr.com/photos/laurentkempe/" target="_blank" rel="noopener" title="Flickr">
                    
                        <i class="sidebar-button-icon fab fa-flickr" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Flickr</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="Tags"
                        >
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="http://feeds.feedburner.com/laurentkempe" target="_blank" rel="noopener" title="RSS">
                    
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
        <div class="post-header-cover
                    text-left
                    post-header-cover--partial"
             style="background-image:url('https://live.staticflickr.com/65535/46849236405_4ce597fca2_h.jpg');"
             data-behavior="5">
            
                <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            WPF and .NET Generic Host with .NET Core 3.0
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2019-09-03T20:21:08+00:00">
	
		    Sep 03, 2019
    	
    </time>
    
</div>

    
</div>

            
        </div>

            <div id="main" data-behavior="5"
                 class="hasCover
                        hasCoverMetaIn
                        hasCoverCaption">
                
<article class="post">
    
        <span class="post-header-cover-caption caption">Lomont, France</span>
    
    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>I like very much the idea of a <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-3.0" target="_blank" rel="noopener">.NET Generic Host in the MSDN documentation</a>:</p>
<blockquote>
<p>An object that encapsulates an app’s resources, such as:</p>
<ul>
<li>Dependency injection (DI)</li>
<li>Logging</li>
<li>Configuration</li>
<li>IHostedService implementations</li>
</ul>
</blockquote>
<a id="more"></a>

<p>The origin of .NET Generic Host is <a href="https://github.com/aspnet/Extensions" target="_blank" rel="noopener">Microsoft.Extensions</a>, a set of .NET APIs for commonly used programming patterns and utilities, such as dependency injection, logging, and application configuration.</p>
<p>Why do I like this idea? Because it means that whatever application you are building using .NET Generic Host, it will always bring all of those services freely in a consistent manner. The application can be an ASP.NET Core application, which is where the idea of Web Host emerged and was refined into a Generic Host.</p>
<p>But, <strong>why couldn’t a WPF application be build using it?</strong> The current WPF template doesn’t use .NET Generic Host! Never the less, let’s modify the code generated by the WPF template to leverage it.</p>
<p>The goal is to have a tiny .NET Core 3.0 WPF application demonstrating each of Dependency injection (DI), Logging and Configuration.</p>
<h1 id="Default-WPF-template"><a href="#Default-WPF-template" class="headerlink" title="Default WPF template"></a>Default WPF template</h1><p>We need to modify the App.xaml so that it doesn’t use StartupUri. Which sets the UI; MainWindow.xaml, that is automatically shown when an application starts. Our goal is to be able to create the Window ourself, using the IOC container, so that we can inject services!</p>
<p>We replace <em>StartupUri</em> by <em>Startup</em> calling <em>Application_Startup</em> and when we are at it, we also add <em>Exit</em> and <em>Application_Exit</em>. This will let us know when the application starts/stops so that we can start/stop the host.</p>
<figure class="highlight csharp"><figcaption><span>App.xaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;Application x:Class=<span class="string">"wpfGenericHost.App"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">             xmlns=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">             xmlns:x=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">             xmlns:local=<span class="string">"clr-namespace:wpfGenericHost"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">             Startup=<span class="string">"Application_Startup"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">             Exit=<span class="string">"Application_Exit"</span>&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    &lt;Application.Resources /&gt;         </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&lt;/Application&gt;</span></pre></td></tr></table></figure>

<figure class="highlight csharp"><figcaption><span>App.xaml.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span> : <span class="title">Application</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">App</span>(<span class="params"></span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Application_Startup</span>(<span class="params"><span class="keyword">object</span> sender, StartupEventArgs e</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Application_Exit</span>(<span class="params"><span class="keyword">object</span> sender, ExitEventArgs e</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>The App constructor seems to be the right place to build our new Host. <em>Application_Startup</em> the place to start the host and <em>Application_Exit</em> the place to stop the host.</p>
<figure class="highlight csharp"><figcaption><span>App.xaml.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span> : <span class="title">Application</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> IHost _host;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">App</span>(<span class="params"></span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        _host = <span class="keyword">new</span> HostBuilder().Build();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Application_Startup</span>(<span class="params"><span class="keyword">object</span> sender, StartupEventArgs e</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">await</span> _host.StartAsync();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Application_Exit</span>(<span class="params"><span class="keyword">object</span> sender, ExitEventArgs e</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">using</span> (_host)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">        &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">            <span class="keyword">await</span> _host.StopAsync(TimeSpan.FromSeconds(<span class="number">5</span>));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h1 id="Dependency-injection-DI"><a href="#Dependency-injection-DI" class="headerlink" title="Dependency injection (DI)"></a>Dependency injection (DI)</h1><p>A first capability that .NET Generic Host is bringing is Dependency injection. We can inject some dependencies to the <em>MainWindow</em> as we delegate it’s creation to the IOC container in <em>Application_Startup</em>. In this example, we are injecting a simple interface called <em>ITextService</em> with one method <em>GetText()</em>.</p>
<div class="alert info"><p>In a real application, we definitely would be able to inject a View Model like <em>MainWindowViewModel</em> which would itself have other dependencies provided by the IOC container.</p>
</div>

<figure class="highlight csharp"><figcaption><span>MainWindow.xaml.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MainWindow</span> : <span class="title">Window</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainWindow</span>(<span class="params">ITextService textService</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        InitializeComponent();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        Label.Content = textService.GetText();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<figure class="highlight csharp"><figcaption><span>App.xaml.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span> : <span class="title">Application</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> IHost _host;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">App</span>(<span class="params"></span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        _host = <span class="keyword">new</span> HostBuilder()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">                    .ConfigureServices((context, services) =&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">                    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">                        services.AddSingleton&lt;ITextService, TextService&gt;();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">                        services.AddSingleton&lt;MainWindow&gt;();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">                    &#125;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">                    .Build();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Application_Startup</span>(<span class="params"><span class="keyword">object</span> sender, StartupEventArgs e</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">await</span> _host.StartAsync();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">var</span> mainWindow = _host.Services.GetService&lt;MainWindow&gt;();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">        mainWindow.Show();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    ...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><p>The second capability of .NET Generic Host we want to explore is Configuration. We want to build the concrete implementation of <em>ITextService</em> with a dependency on an external configuration to get the text to display in the main window.</p>
<p>The configuration is handled by a concrete class called <em>Settings</em> and the <em>appsettings.json</em> configuration file. Both have a property called <em>Text</em>.</p>
<figure class="highlight csharp"><figcaption><span>Settings.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Settings</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Text &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<figure class="highlight json"><figcaption><span>appsettings.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"Text"</span>: <span class="string">"Hello WPF .NET Core 3.0\nfrom .NET Generic Host!"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<figure class="highlight csharp"><figcaption><span>TextService.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">TextService</span> : <span class="title">ITextService</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> _text;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TextService</span>(<span class="params">IOptions&lt;Settings&gt; options</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        _text = options.Value.Text;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">GetText</span>(<span class="params"></span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">return</span> _text;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>We register the <em>Settings</em> class in the IOC container so that it is resolved and injected as <em>IOptions<Settings></em> in our concrete class <em>TextService</em>.</p>
<figure class="highlight csharp"><figcaption><span>App.xaml.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span> : <span class="title">Application</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> IHost _host;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Settings _settings;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">App</span>(<span class="params"></span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        _host = <span class="keyword">new</span> HostBuilder()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">                    .ConfigureAppConfiguration((context, configurationBuilder) =&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">                    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">                        configurationBuilder.SetBasePath(context.HostingEnvironment.ContentRootPath);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">                        configurationBuilder.AddJsonFile(<span class="string">"appsettings.json"</span>, optional: <span class="literal">false</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">                    &#125;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">                    .ConfigureServices((context, services) =&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">                    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">                        services.Configure&lt;Settings&gt;(context.Configuration);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">                        services.AddSingleton&lt;ITextService, TextService&gt;();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">                        services.AddSingleton&lt;MainWindow&gt;();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">                    &#125;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">                    .Build();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    ...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h1 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h1><p>The final capability of .NET Generic Host we want to have a look at is Logging. In our simple example, we will just add the possibility to output logs to the Console. Again, we are injecting an <em>ILogger</em> into our concrete class <em>TextService</em> to be able to write a piece of information to our logs.</p>
<figure class="highlight csharp"><figcaption><span>TextService.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">TextService</span> : <span class="title">ITextService</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> _text;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TextService</span>(<span class="params">IOptions&lt;Settings&gt; options, ILogger&lt;TextService&gt; logger</span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        _text = options.Value.Text;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        logger.LogInformation(<span class="string">$"Text read from settings: '<span class="subst">&#123;options.Value.Text&#125;</span>'"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">GetText</span>(<span class="params"></span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">return</span> _text;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<figure class="highlight csharp"><figcaption><span>App.xaml.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span> : <span class="title">Application</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> IHost _host;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">App</span>(<span class="params"></span>)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="function"></span>    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        _host = <span class="keyword">new</span> HostBuilder()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">                    .ConfigureAppConfiguration((context, configurationBuilder) =&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">                    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">                        configurationBuilder.SetBasePath(context.HostingEnvironment.ContentRootPath);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">                        configurationBuilder.AddJsonFile(<span class="string">"appsettings.json"</span>, optional: <span class="literal">false</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">                    &#125;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">                    .ConfigureServices((context, services) =&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">                    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">                        services.Configure&lt;Settings&gt;(context.Configuration);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">                        services.AddSingleton&lt;ITextService, TextService&gt;();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">                        services.AddSingleton&lt;MainWindow&gt;();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">                    &#125;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">                    .ConfigureLogging(logging =&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">                    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">                        logging.AddConsole();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">                    &#125;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">                    .Build();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">    ...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h1 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h1><p>We can run the application and see that <em>MainWindow</em> is created using the <em>TextService</em> which read the <em>Text</em> property of <em>appsettings.json</em> and our WPF application correctly displays the text.</p>
<p><img src="https://live.staticflickr.com/65535/48673324906_115675602b_o.png%22" alt="WPF and .NET Generic Host with .NET Core 3.0"></p>
<p>And the output in the log</p>
<p><img src="https://live.staticflickr.com/65535/48673362031_ab8e1f486b_o.png" alt=""></p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>We have seen all the benefits the .NET Generic Host is bringing. It was easy to integrate into WPF applications, even if Microsoft is not currently providing a .NET Core template for that particular usage. But it seems that the idea is open to discussion, you can read more about it on Github issue “<a href="https://github.com/dotnet/wpf/issues/499" target="_blank" rel="noopener">Make Future WPF IoC Friendly #499</a>“.</p>
<p>You can get all the code on GitHub </p>
<div style="text-align: left">
  <div class="github-card"
    data-user="laurentkempe"
    data-repo="WpfGenericHost"
    data-height="200"
    data-width="400"
    data-theme="default"
    data-target=""
    data-client-id=""
    data-client-secret=""
  ></div>
</div>
<script src="/github-card-lib/githubcard.js"></script>


            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/NET-Core/" rel="tag">.NET Core</a> <a class="tag tag--primary tag--small t-link" href="/tags/WPF/" rel="tag">WPF</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2019/09/18/gRPC-and-csharp-8-Async-stream/"
                    data-tooltip="gRPC and C# 8 Async stream"
                    aria-label="PREVIOUS: gRPC and C# 8 Async stream"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2019/04/18/WPF-and-IOC-on-NET-Core-3-0/"
                    data-tooltip="WPF and IOC on .NET Core 3.0"
                    aria-label="NEXT: WPF and IOC on .NET Core 3.0"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 Laurent Kempé. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2019/09/18/gRPC-and-csharp-8-Async-stream/"
                    data-tooltip="gRPC and C# 8 Async stream"
                    aria-label="PREVIOUS: gRPC and C# 8 Async stream"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2019/04/18/WPF-and-IOC-on-NET-Core-3-0/"
                    data-tooltip="WPF and IOC on .NET Core 3.0"
                    aria-label="NEXT: WPF and IOC on .NET Core 3.0"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/"
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Laurent Kempé</h4>
        
            <div id="about-card-bio"><p>I am an experienced Team Leader &amp; Senior Solutions Architect with a passion for shipping high-quality products by empowering development team and culture toward an agile mindset. I bring technical vision and strategy, leading engineering teams to move product, processes and architecture forward.</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Team Leader, Senior Solutions Architect</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Illzach, France
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('https://farm5.staticflickr.com/4437/37116073235_dda239221d_o.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-dqmwcnb5gite4uhoonz1buloza5z0fesqti9dqdxnmyaqwic55sf3cmk5hbn.min.js"></script>
<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'https://laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/';
              
            this.page.identifier = '20190903222108';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'laurentkempe';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    




    </body>
</html>
