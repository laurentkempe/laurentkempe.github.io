
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Laurent Kemp√©">
    <title>.NET 7 SDK built-in container support and Ubuntu Chiseled - Laurent Kemp√©</title>
    <meta name="author" content="Laurent Kemp√©">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Laurent Kemp√©","sameAs":["https://github.com/laurentkempe","https://twitter.com/laurentkempe","https://www.linkedin.com/in/laurentkempe","https://flickr.com/photos/laurentkempe/"],"image":"https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg"},"articleBody":"End of summer 2022, the .NET team at Microsoft announced two things related to containers: .NET in Chiseled Ubuntu containers and then a week after built-in container support in the .NET 7 SDK. I have talked about both topics on two episodes of the French podcast devdevdev.net by my friend Richard Clark. In this post, I will explain what those are and how to combine them.\n\n\n.NET in Chiseled Ubuntu containers.NET in Chiseled Ubuntu containers are new small and secure containers offered by Canonical. Those images are 100MB smaller than the Ubuntu image.\nWhy does it improve security? Because small images reduce the attack surface. Based on images with only the packages required to run the container, no package manager, no shell, and non-root user.   \nThe idea originates from distroless concept introduced in 2017 by Google. On top of that, it brings the following features: polished tools and trusted packages from platform providers, choice of free or paid support, choice of fast-moving releases or LTS, possibility to customize the images.\n\nTo take advantage of those new images, in .NET 6 and 7 for Arm64 and x64, you need to use one of the three layers of Chiseled Ubuntu container images. \n\nmcr.microsoft.com&#x2F;dotnet&#x2F;nightly&#x2F;runtime-deps:7.0-jammy-chiseled \nmcr.microsoft.com&#x2F;dotnet&#x2F;nightly&#x2F;runtime:7.0-jammy-chiseled \nmcr.microsoft.com&#x2F;dotnet&#x2F;nightly&#x2F;aspnet:7.0-jammy-chiseled\n\nToday this is still in preview, and images are served from the nightly repository. Final images will be available before end of this year.\n\n\nBuilt-in container support in the .NET 7 SDKYou can use Dockerfile to bundle your .NET application in a container. You create a Dockerfile, install the .NET SDK, restore the packages, build the application, and copy the output in the container. It implies quite some steps and is not easy to do right.\nToday, .NET 7 SDK supports container images as a new output type through a simple dotnet publish. This was already the case on other platforms Ko for Go, Jib for Java, and even in .NET with projects like konet.\nIt requires only adding one NuGet package reference to the project file:\n1&lt;PackageReference Include=&quot;Microsoft.NET.Build.Containers&quot; Version=&quot;0.2.7&quot;/&gt;\n\nIn the future it will be part of the SDK, so you will not need to add this NuGet package reference.\n\n\nCurrently, only Linux containers are supported.\n\n\nThen you can run the following command:\n123456789 ‚ùØ  dotnet publish --os linux --arch x64 -p:PublishProfile=DefaultContainer -c ReleaseMSBuild version 17.4.0+18d5aef85 for .NET  Determining projects to restore...  All projects are up-to-date for restore.  WebApp -&gt; C:\\Users\\laure\\projects\\dotnet\\7rtm\\ParsableStatic\\WebApp\\bin\\Release\\net7.0\\linux-x64\\WebApp.dll  WebApp -&gt; C:\\Users\\laure\\projects\\dotnet\\7rtm\\ParsableStatic\\WebApp\\bin\\Release\\net7.0\\linux-x64\\publish\\  &#x27;WebApp&#x27; was not a valid container image name, it was normalized to webapp  Building image &#x27;webapp&#x27; with tags 1.0.0 on top of base image mcr.microsoft.com/dotnet/aspnet:7.0  Pushed container &#x27;webapp:1.0.0&#x27; to Docker daemon\n\nThe image created is 216MB\n123 ‚ùØ  docker image listREPOSITORY   TAG       IMAGE ID       CREATED         SIZEwebapp       1.0.0     e2d2de6a8878   4 seconds ago   216MB\n\nYou can control many of the properties of the image created, like the image name and tags, through MSBuild properties. See, Configure container image.\n1234&lt;PropertyGroup&gt;    &lt;ContainerImageName&gt;dotnet-webapp-image&lt;/ContainerImageName&gt;    &lt;ContainerImageTag&gt;1.1.0&lt;/ContainerImageTag&gt;&lt;/PropertyGroup&gt;\n\nAfter dotnet publish, the image with the new name and version is created\n1234 ‚ùØ  docker image listREPOSITORY            TAG       IMAGE ID       CREATED          SIZEdotnet-webapp-image   1.1.0     d63f313397aa   2 seconds ago    216MBwebapp                1.0.0     e2d2de6a8878   50 seconds ago   216MB\n\nCan we combine the two?Sure. We can combine the two and create a .NET application in a Chiseled Ubuntu container using the .NET SDK. It is a great way to create a small and secure container for your .NET application.\nWe need to add MSBuild property ContainerBaseImage to our csproj file to specify the Chiseled Ubuntu base image to use, in this case, aspnet:7.0-jammy-chiseled.\n123456789&lt;PropertyGroup&gt;    &lt;ContainerImageName&gt;dotnet-webapp-chiseled&lt;/ContainerImageName&gt;    &lt;ContainerImageTag&gt;1.1.0&lt;/ContainerImageTag&gt;    &lt;ContainerBaseImage&gt;mcr.microsoft.com/dotnet/nightly/aspnet:7.0-jammy-chiseled&lt;/ContainerBaseImage&gt;&lt;/PropertyGroup&gt;&lt;ItemGroup&gt;    &lt;PackageReference Include=&quot;Microsoft.NET.Build.Containers&quot; Version=&quot;0.2.7&quot;/&gt;&lt;/ItemGroup&gt;\n\nThis time the image is 112MB compared to the 216MB. We won 104MB on top of all other advantages from the Chiseled Ubuntu container.\n1234567 ‚ùØ  dotnet publish --os linux --arch x64 -p:PublishProfile=DefaultContainer -c Release ... ‚ùØ  docker image listREPOSITORY               TAG       IMAGE ID       CREATED              SIZEdotnet-webapp-chiseled   1.1.0     a0456f5d4b27   4 seconds ago        112MBdotnet-webapp-image      1.1.0     d63f313397aa   About a minute ago   216MBwebapp                   1.0.0     e2d2de6a8878   2 minutes ago        216MB\n\nCan we do better?Yes, we can üòâ mixing chiseling and trimming. \nWe can use the base image runtime-deps:7.0-jammy-chiseled, which is 13MB and publish our ASP.NET application as a self-contained and trimmed application.\n12345678910&lt;PropertyGroup&gt;    &lt;ContainerImageName&gt;dotnet-webapp-chiseled-trimmed&lt;/ContainerImageName&gt;    &lt;ContainerImageTag&gt;1.1.0&lt;/ContainerImageTag&gt;    &lt;ContainerBaseImage&gt;mcr.microsoft.com/dotnet/nightly/runtime-deps:7.0-jammy-chiseled&lt;/ContainerBaseImage&gt;    &lt;PublishTrimmed&gt;true&lt;/PublishTrimmed&gt;&lt;/PropertyGroup&gt;&lt;ItemGroup&gt;    &lt;PackageReference Include=&quot;Microsoft.NET.Build.Containers&quot; Version=&quot;0.2.7&quot;/&gt;&lt;/ItemGroup&gt;\n\nWe need to add ‚Äìself-contained to the dotnet publish command. Now, the image is 56.5MB compared to the 112MB, we won 55.5MB.\n12345678910 ‚ùØ  dotnet publish --os linux --arch x64 -p:PublishProfile=DefaultContainer -c Release --self-contained ...   Optimizing assemblies for size. This process might take a while. ... ‚ùØ  docker image listREPOSITORY                       TAG       IMAGE ID       CREATED          SIZEdotnet-webapp-chiseled-trimmed   1.1.0     f1ba30048ef8   11 seconds ago   56.5MBdotnet-webapp-chiseled           1.1.0     a0456f5d4b27   2 minutes ago    112MBdotnet-webapp-image              1.1.0     d63f313397aa   4 minutes ago    216MBwebapp                           1.0.0     e2d2de6a8878   5 minutes ago    216MB\n\nCan we do even better?Yes, we can by publishing to a single file\n123456&lt;PropertyGroup&gt;    &lt;ContainerImageName&gt;dotnet-webapp-chiseled-trimmed-singlefile&lt;/ContainerImageName&gt;    &lt;ContainerImageTag&gt;1.1.0&lt;/ContainerImageTag&gt;    &lt;ContainerBaseImage&gt;mcr.microsoft.com/dotnet/nightly/runtime-deps:7.0-jammy-chiseled&lt;/ContainerBaseImage&gt;    &lt;PublishTrimmed&gt;true&lt;/PublishTrimmed&gt;&lt;/PropertyGroup&gt;\n\nWe need to add -p:PublishSingleFile&#x3D;true to the dotnet publish command. Now, the image is 48.4MB compared to the 56.5MB, we won 8.1MB.\n123456789 ‚ùØ  dotnet publish --os linux --arch x64 -p:PublishProfile=DefaultContainer -c Release --self-contained true -p:PublishSingleFile=true... ‚ùØ  docker image listREPOSITORY                                  TAG       IMAGE ID       CREATED          SIZEdotnet-webapp-chiseled-trimmed-singlefile   1.1.0     2643c10fa1d9   56 seconds ago   48.4MBdotnet-webapp-chiseled-trimmed              1.1.0     f1ba30048ef8   11 seconds ago   56.5MBdotnet-webapp-chiseled                      1.1.0     a369967b535a   15 minutes ago   112MBdotnet-webapp-image                         1.1.0     d63f313397aa   31 minutes ago   216MBwebapp                                      1.0.0     e2d2de6a8878   32 minutes ago   216MB\n\nA tiny bit better?If you don‚Äôt need globalization in your application, you can turn on the globalization invariant mode.\n1234567&lt;PropertyGroup&gt;    &lt;ContainerImageName&gt;dotnet-webapp-chiseled-trimmed-singlefile-invariant&lt;/ContainerImageName&gt;    &lt;ContainerImageTag&gt;1.1.0&lt;/ContainerImageTag&gt;    &lt;ContainerBaseImage&gt;mcr.microsoft.com/dotnet/nightly/runtime-deps:7.0-jammy-chiseled&lt;/ContainerBaseImage&gt;    &lt;InvariantGlobalization&gt;true&lt;/InvariantGlobalization&gt;    &lt;PublishTrimmed&gt;true&lt;/PublishTrimmed&gt;&lt;/PropertyGroup&gt;\n\nFinally, the image is 48.3MB compared to the 48.4MB. We won 0.1MB.\n12345678910 ‚ùØ  dotnet publish --os linux --arch x64 -p:PublishProfile=DefaultContainer -c Release --self-contained true -p:PublishSingleFile=true ... ‚ùØ  docker image listREPOSITORY                                            TAG       IMAGE ID       CREATED          SIZEdotnet-webapp-chiseled-trimmed-singlefile-invariant   1.1.0     fd7c4aca6501   19 seconds ago   48.3MBdotnet-webapp-chiseled-trimmed-singlefile             1.1.0     2643c10fa1d9   8 minutes ago    48.4MBdotnet-webapp-chiseled-trimmed                        1.1.0     df989eda0f7f   13 minutes ago   48.4MBdotnet-webapp-chiseled                                1.1.0     a369967b535a   22 minutes ago   112MBdotnet-webapp-image                                   1.1.0     d63f313397aa   38 minutes ago   216MBwebapp                                                1.0.0     e2d2de6a8878   39 minutes ago   216MB\n\nI expected better results with this last step. The runtime-deps:6.0-jammy-chiseled removes ICU and sets DOTNET_SYSTEM_GLOBALIZATION_INVARIANT=true. I guess runtime-deps:7.0-jammy-chiseled does the same, but the code is not yet available.\nHey @runfaster2000 and @ValentinViennot Great presentation during the #dotnetConf üëçüèº Any plan to ship another 7.0-jammy-chiseled without ICU?&mdash; Laurent Kemp√© (@laurentkempe) November 13, 2022 \n\nRun123456789 ‚ùØ  docker run --rm -it -p 8080:80  dotnet-webapp-chiseled-trimmed-singlefile-invariant:1.1.0info: Microsoft.Hosting.Lifetime[14]      Now listening on: http://[::]:80info: Microsoft.Hosting.Lifetime[0]      Application started. Press Ctrl+C to shut down.info: Microsoft.Hosting.Lifetime[0]      Hosting environment: Productioninfo: Microsoft.Hosting.Lifetime[0]      Content root path: /app\n\nThen you can browse to http://localhost:8080/weatherforecast to see \n\nConclusionNow that .NET 7 RTM shipped, we can leverage those new capabilities. It lets us create small and secure containers for our .NET applications easily.\nWe went from a first docker image of 216MB to a final docker image of 48.3MB. That‚Äôs more than a 77% reduction in size.\nI hope you enjoyed this post and learned something new that you want to try out. If you have any questions or comments, please leave them below. Thanks for reading!\nCode\n\n  \n\n\n\n\nPresentationUsing .NET with Chiseled Ubuntu Containers\nChiseled Ubuntu Containers are new and exciting. You‚Äôll see how easy it is to switch to using them with .NET and what the benefits are. We‚Äôll show using them at your desktop, deploying them to the cloud, and also making an evil hacker fail to compromise an app (that might otherwise succeed).\n\n \n\n\n.NET in Ubuntu and Chiseled Containers - Canonical &amp; Microsoft\nFolks at Microsoft reached out to Canonical with a ‚Äúsimple‚Äù request, for Ubuntu distroless container images. The two companies partnered together to produce super small and secure container images, about 100MB smaller than regular container images. You can start using these images now, for much better performance.\n\n\n\n\nReferences\n.NET in Chiseled Ubuntu Containers\nAnnouncing built-in container support for the .NET SDK\nPublish to a container\ndotnet &#x2F; sdk-container-builds\n.NET Core Globalization Invariant Mode\ndevdevdev.net\n\n","dateCreated":"2022-11-14T12:40:41+00:00","dateModified":"2023-10-30T12:55:53+00:00","datePublished":"2022-11-14T12:40:41+00:00","description":"End of summer 2022, the .NET team at Microsoft announced two things related to containers: .NET in Chiseled Ubuntu containers and then a week after built-in container support in the .NET 7 SDK. I have talked about both topics on two episodes of the French podcast devdevdev.net by my friend Richard Clark. In this post, I will explain what those are and how to combine them.","headline":".NET 7 SDK built-in container support and Ubuntu Chiseled","image":["https://live.staticflickr.com/4401/36848984906_f7a10e1aca_q.jpg","https://live.staticflickr.com/4401/36848984906_a51b695ef2_h.jpg"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/"},"publisher":{"@type":"Organization","name":"Laurent Kemp√©","sameAs":["https://github.com/laurentkempe","https://twitter.com/laurentkempe","https://www.linkedin.com/in/laurentkempe","https://flickr.com/photos/laurentkempe/"],"image":"https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg","logo":{"@type":"ImageObject","url":"https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg"}},"url":"https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/","keywords":"ASP.NET Core, Docker, .NET SDK, Ubuntu","thumbnailUrl":"https://live.staticflickr.com/4401/36848984906_f7a10e1aca_q.jpg"}</script>
    <meta name="description" content="End of summer 2022, the .NET team at Microsoft announced two things related to containers: .NET in Chiseled Ubuntu containers and then a week after built-in container support in the .NET 7 SDK. I have">
<meta property="og:type" content="blog">
<meta property="og:title" content=".NET 7 SDK built-in container support and Ubuntu Chiseled">
<meta property="og:url" content="https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/index.html">
<meta property="og:site_name" content="Laurent Kemp√©">
<meta property="og:description" content="End of summer 2022, the .NET team at Microsoft announced two things related to containers: .NET in Chiseled Ubuntu containers and then a week after built-in container support in the .NET 7 SDK. I have">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://laurentkempe.com/images/standardvsChiseledDotNETimages.png">
<meta property="og:image" content="https://laurentkempe.com/images/dotnet-webapp-chiseled-trimmed-singlefile-invariant.png">
<meta property="article:published_time" content="2022-11-14T12:40:41.000Z">
<meta property="article:modified_time" content="2023-10-30T12:55:53.137Z">
<meta property="article:author" content="Laurent Kemp√©">
<meta property="article:tag" content="ASP.NET Core">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content=".NET SDK">
<meta property="article:tag" content="Ubuntu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://laurentkempe.com/images/standardvsChiseledDotNETimages.png">
<meta name="twitter:creator" content="@laurentkempe">
    
    
        
    
    
        <meta property="og:image" content="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg"/>
    
    
        <meta property="og:image" content="https://live.staticflickr.com/4401/36848984906_f7a10e1aca_q.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://live.staticflickr.com/4401/36848984906_f7a10e1aca_q.jpg"/>
    
    
        <meta property="og:image" content="https://live.staticflickr.com/4401/36848984906_a51b695ef2_h.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://live.staticflickr.com/4401/36848984906_a51b695ef2_h.jpg"/>
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-ggm0m14rubpen7bf4lgf0iykfxmvj8hnuakubye3twmklxevh5osd5qqxh9b.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Laurent Kemp√©
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Laurent Kemp√©</h4>
                
                    <h5 class="sidebar-profile-bio"><p>I am an experienced Team Leader &amp; Distinguished Solution Architect with a passion for shipping high-quality products by empowering development team and culture toward an agile mindset. I bring technical vision and strategy, leading engineering teams to move product, processes and architecture forward.</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/presentations.html"
                            
                            rel="noopener"
                            title="Presentations"
                        >
                        <i class="sidebar-button-icon fa fa-file-powerpoint" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Presentations</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/about-laurent-kempe.html"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/laurentkempe"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/laurentkempe"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/laurentkempe"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://flickr.com/photos/laurentkempe/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Flickr"
                        >
                        <i class="sidebar-button-icon fab fa-flickr" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Flickr</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://feeds.feedburner.com/laurentkempe"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
        <div class="post-header-cover
                    text-left
                    post-header-cover--partial"
             style="background-image:url('https://live.staticflickr.com/4401/36848984906_a51b695ef2_h.jpg');"
             data-behavior="5">
            
                <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            .NET 7 SDK built-in container support and Ubuntu Chiseled
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2022-11-14T12:40:41+00:00">
	
		    Nov 14, 2022
    	
    </time>
    
</div>

    
</div>

            
        </div>

            <div id="main" data-behavior="5"
                 class="hasCover
                        hasCoverMetaIn
                        hasCoverCaption">
                
<article class="post">
    
        <span class="post-header-cover-caption caption">Mo ªorea, Polyn√©sie, France</span>
    
    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>End of summer 2022, the .NET team at Microsoft announced two things related to containers: .NET in Chiseled Ubuntu containers and then a week after built-in container support in the .NET 7 SDK. I have talked about both topics on two episodes of the French podcast <a target="_blank" rel="noopener" href="https://devdevdev.net/">devdevdev.net</a> by my friend <a target="_blank" rel="noopener" href="https://twitter.com/c2iClark">Richard Clark</a>. In this post, I will explain what those are and how to combine them.</p>
<span id="more"></span>

<h1 id="NET-in-Chiseled-Ubuntu-containers"><a href="#NET-in-Chiseled-Ubuntu-containers" class="headerlink" title=".NET in Chiseled Ubuntu containers"></a>.NET in Chiseled Ubuntu containers</h1><p>.NET in Chiseled Ubuntu containers are new <strong>small</strong> and <strong>secure containers</strong> offered by Canonical. Those images are <strong>100MB smaller</strong> than the Ubuntu image.</p>
<p>Why does it improve security? Because small images reduce the attack surface. Based on images with only the packages required to run the container, no package manager, no shell, and non-root user.   </p>
<p>The idea originates from distroless concept introduced in 2017 by Google. On top of that, it brings the following features: polished tools and trusted packages from platform providers, choice of free or paid support, choice of fast-moving releases or LTS, possibility to customize the images.</p>
<p><img src="/images/standardvsChiseledDotNETimages.png" alt="Standard vs Chiseled .NET Images"></p>
<p>To take advantage of those new images, in .NET 6 and 7 for Arm64 and x64, you need to use one of the three layers of Chiseled Ubuntu container images. </p>
<ul>
<li>mcr.microsoft.com&#x2F;dotnet&#x2F;nightly&#x2F;runtime-deps:7.0-jammy-chiseled </li>
<li>mcr.microsoft.com&#x2F;dotnet&#x2F;nightly&#x2F;runtime:7.0-jammy-chiseled </li>
<li>mcr.microsoft.com&#x2F;dotnet&#x2F;nightly&#x2F;aspnet:7.0-jammy-chiseled</li>
</ul>
<div class="alert info"><p>Today this is still in preview, and images are served from the nightly repository. Final images will be available before end of this year.</p>
</div>

<h1 id="Built-in-container-support-in-the-NET-7-SDK"><a href="#Built-in-container-support-in-the-NET-7-SDK" class="headerlink" title="Built-in container support in the .NET 7 SDK"></a>Built-in container support in the .NET 7 SDK</h1><p>You can use Dockerfile to bundle your .NET application in a container. You create a Dockerfile, install the .NET SDK, restore the packages, build the application, and copy the output in the container. It implies quite some steps and is not easy to do right.</p>
<p>Today, .NET 7 SDK supports <strong>container images</strong> as a new output type through a simple <strong>dotnet publish</strong>. This was already the case on other platforms Ko for Go, Jib for Java, and even in .NET with projects like konet.</p>
<p>It requires only adding one NuGet package reference to the project file:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">&quot;Microsoft.NET.Build.Containers&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;0.2.7&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<div class="alert info"><p>In the future it will be part of the SDK, so you will not need to add this NuGet package reference.</p>
</div>

<div class="alert info"><p>Currently, only Linux containers are supported.</p>
</div>

<p>Then you can run the following command:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> ‚ùØ  dotnet publish <span class="literal">--os</span> linux <span class="literal">--arch</span> x64 <span class="literal">-p</span>:PublishProfile=DefaultContainer <span class="literal">-c</span> Release</span><br><span class="line">MSBuild version <span class="number">17.4</span>.<span class="number">0</span>+<span class="number">18</span>d5aef85 <span class="keyword">for</span> .NET</span><br><span class="line">  Determining projects to restore...</span><br><span class="line">  All projects are up<span class="literal">-to-date</span> <span class="keyword">for</span> restore.</span><br><span class="line">  WebApp -&gt; C:\Users\laure\projects\dotnet\<span class="number">7</span>rtm\ParsableStatic\WebApp\bin\Release\net7.<span class="number">0</span>\linux<span class="literal">-x64</span>\WebApp.dll</span><br><span class="line">  WebApp -&gt; C:\Users\laure\projects\dotnet\<span class="number">7</span>rtm\ParsableStatic\WebApp\bin\Release\net7.<span class="number">0</span>\linux<span class="literal">-x64</span>\publish\</span><br><span class="line">  <span class="string">&#x27;WebApp&#x27;</span> was not a valid container image name, it was normalized to webapp</span><br><span class="line">  Building image <span class="string">&#x27;webapp&#x27;</span> with tags <span class="number">1.0</span>.<span class="number">0</span> on top of base image mcr.microsoft.com/dotnet/aspnet:<span class="number">7.0</span></span><br><span class="line">  Pushed container <span class="string">&#x27;webapp:1.0.0&#x27;</span> to Docker daemon</span><br></pre></td></tr></table></figure>

<p>The image created is <strong>216MB</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> ‚ùØ  docker image list</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">webapp       <span class="number">1.0</span>.<span class="number">0</span>     e2d2de6a8878   <span class="number">4</span> seconds ago   <span class="number">216</span>MB</span><br></pre></td></tr></table></figure>

<p>You can control many of the properties of the image created, like the image name and tags, through MSBuild properties. See, <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/dotnet/core/docker/publish-as-container#configure-container-image">Configure container image</a>.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerImageName</span>&gt;</span>dotnet-webapp-image<span class="tag">&lt;/<span class="name">ContainerImageName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerImageTag</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">ContainerImageTag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>After dotnet publish, the image with the new name and version is created</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> ‚ùØ  docker image list</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">dotnet<span class="literal">-webapp-image</span>   <span class="number">1.1</span>.<span class="number">0</span>     d63f313397aa   <span class="number">2</span> seconds ago    <span class="number">216</span>MB</span><br><span class="line">webapp                <span class="number">1.0</span>.<span class="number">0</span>     e2d2de6a8878   <span class="number">50</span> seconds ago   <span class="number">216</span>MB</span><br></pre></td></tr></table></figure>

<h1 id="Can-we-combine-the-two"><a href="#Can-we-combine-the-two" class="headerlink" title="Can we combine the two?"></a>Can we combine the two?</h1><p>Sure. We can combine the two and create a .NET application in a Chiseled Ubuntu container using the .NET SDK. It is a great way to create a small and secure container for your .NET application.</p>
<p>We need to add MSBuild property <strong>ContainerBaseImage</strong> to our csproj file to specify the Chiseled Ubuntu base image to use, in this case, <strong>aspnet:7.0-jammy-chiseled</strong>.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerImageName</span>&gt;</span>dotnet-webapp-chiseled<span class="tag">&lt;/<span class="name">ContainerImageName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerImageTag</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">ContainerImageTag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerBaseImage</span>&gt;</span>mcr.microsoft.com/dotnet/nightly/aspnet:7.0-jammy-chiseled<span class="tag">&lt;/<span class="name">ContainerBaseImage</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">&quot;Microsoft.NET.Build.Containers&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;0.2.7&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>This time the image is <strong>112MB</strong> compared to the 216MB. We <strong>won 104MB</strong> on top of all other advantages from the Chiseled Ubuntu container.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> ‚ùØ  dotnet publish <span class="literal">--os</span> linux <span class="literal">--arch</span> x64 <span class="literal">-p</span>:PublishProfile=DefaultContainer <span class="literal">-c</span> Release</span><br><span class="line"> ...</span><br><span class="line"> ‚ùØ  docker image list</span><br><span class="line">REPOSITORY               TAG       IMAGE ID       CREATED              SIZE</span><br><span class="line">dotnet<span class="literal">-webapp-chiseled</span>   <span class="number">1.1</span>.<span class="number">0</span>     a0456f5d4b27   <span class="number">4</span> seconds ago        <span class="number">112</span>MB</span><br><span class="line">dotnet<span class="literal">-webapp-image</span>      <span class="number">1.1</span>.<span class="number">0</span>     d63f313397aa   About a minute ago   <span class="number">216</span>MB</span><br><span class="line">webapp                   <span class="number">1.0</span>.<span class="number">0</span>     e2d2de6a8878   <span class="number">2</span> minutes ago        <span class="number">216</span>MB</span><br></pre></td></tr></table></figure>

<h1 id="Can-we-do-better"><a href="#Can-we-do-better" class="headerlink" title="Can we do better?"></a>Can we do better?</h1><p>Yes, we can üòâ mixing chiseling and trimming. </p>
<p>We can use the base image <strong>runtime-deps:7.0-jammy-chiseled</strong>, which is 13MB and publish our ASP.NET application as a self-contained and trimmed application.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerImageName</span>&gt;</span>dotnet-webapp-chiseled-trimmed<span class="tag">&lt;/<span class="name">ContainerImageName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerImageTag</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">ContainerImageTag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerBaseImage</span>&gt;</span>mcr.microsoft.com/dotnet/nightly/runtime-deps:7.0-jammy-chiseled<span class="tag">&lt;/<span class="name">ContainerBaseImage</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PublishTrimmed</span>&gt;</span>true<span class="tag">&lt;/<span class="name">PublishTrimmed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">&quot;Microsoft.NET.Build.Containers&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;0.2.7&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>We need to add <strong>‚Äìself-contained</strong> to the dotnet publish command. Now, the image is <strong>56.5MB</strong> compared to the 112MB, we won 55.5MB.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> ‚ùØ  dotnet publish <span class="literal">--os</span> linux <span class="literal">--arch</span> x64 <span class="literal">-p</span>:PublishProfile=DefaultContainer <span class="literal">-c</span> Release <span class="literal">--self-contained</span></span><br><span class="line"> ...</span><br><span class="line">   Optimizing assemblies <span class="keyword">for</span> size. This <span class="keyword">process</span> might take a <span class="keyword">while</span>.</span><br><span class="line"> ...</span><br><span class="line"> ‚ùØ  docker image list</span><br><span class="line">REPOSITORY                       TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">dotnet<span class="literal">-webapp-chiseled-trimmed</span>   <span class="number">1.1</span>.<span class="number">0</span>     f1ba30048ef8   <span class="number">11</span> seconds ago   <span class="number">56.5</span>MB</span><br><span class="line">dotnet<span class="literal">-webapp-chiseled</span>           <span class="number">1.1</span>.<span class="number">0</span>     a0456f5d4b27   <span class="number">2</span> minutes ago    <span class="number">112</span>MB</span><br><span class="line">dotnet<span class="literal">-webapp-image</span>              <span class="number">1.1</span>.<span class="number">0</span>     d63f313397aa   <span class="number">4</span> minutes ago    <span class="number">216</span>MB</span><br><span class="line">webapp                           <span class="number">1.0</span>.<span class="number">0</span>     e2d2de6a8878   <span class="number">5</span> minutes ago    <span class="number">216</span>MB</span><br></pre></td></tr></table></figure>

<h1 id="Can-we-do-even-better"><a href="#Can-we-do-even-better" class="headerlink" title="Can we do even better?"></a>Can we do even better?</h1><p>Yes, we can by publishing to a single file</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerImageName</span>&gt;</span>dotnet-webapp-chiseled-trimmed-singlefile<span class="tag">&lt;/<span class="name">ContainerImageName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerImageTag</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">ContainerImageTag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerBaseImage</span>&gt;</span>mcr.microsoft.com/dotnet/nightly/runtime-deps:7.0-jammy-chiseled<span class="tag">&lt;/<span class="name">ContainerBaseImage</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PublishTrimmed</span>&gt;</span>true<span class="tag">&lt;/<span class="name">PublishTrimmed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>We need to add <strong>-p:PublishSingleFile&#x3D;true</strong> to the dotnet publish command. Now, the image is <strong>48.4MB</strong> compared to the 56.5MB, we won 8.1MB.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> ‚ùØ  dotnet publish <span class="literal">--os</span> linux <span class="literal">--arch</span> x64 <span class="literal">-p</span>:PublishProfile=DefaultContainer <span class="literal">-c</span> Release <span class="literal">--self-contained</span> true <span class="literal">-p</span>:PublishSingleFile=true</span><br><span class="line">...</span><br><span class="line"> ‚ùØ  docker image list</span><br><span class="line">REPOSITORY                                  TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">dotnet<span class="literal">-webapp-chiseled-trimmed-singlefile</span>   <span class="number">1.1</span>.<span class="number">0</span>     <span class="number">2643</span>c10fa1d9   <span class="number">56</span> seconds ago   <span class="number">48.4</span>MB</span><br><span class="line">dotnet<span class="literal">-webapp-chiseled-trimmed</span>              <span class="number">1.1</span>.<span class="number">0</span>     f1ba30048ef8   <span class="number">11</span> seconds ago   <span class="number">56.5</span>MB</span><br><span class="line">dotnet<span class="literal">-webapp-chiseled</span>                      <span class="number">1.1</span>.<span class="number">0</span>     a369967b535a   <span class="number">15</span> minutes ago   <span class="number">112</span>MB</span><br><span class="line">dotnet<span class="literal">-webapp-image</span>                         <span class="number">1.1</span>.<span class="number">0</span>     d63f313397aa   <span class="number">31</span> minutes ago   <span class="number">216</span>MB</span><br><span class="line">webapp                                      <span class="number">1.0</span>.<span class="number">0</span>     e2d2de6a8878   <span class="number">32</span> minutes ago   <span class="number">216</span>MB</span><br></pre></td></tr></table></figure>

<h1 id="A-tiny-bit-better"><a href="#A-tiny-bit-better" class="headerlink" title="A tiny bit better?"></a>A tiny bit better?</h1><p>If you don‚Äôt need globalization in your application, you can turn on the <a target="_blank" rel="noopener" href="https://github.com/dotnet/runtime/blob/main/docs/design/features/globalization-invariant-mode.md">globalization invariant mode</a>.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerImageName</span>&gt;</span>dotnet-webapp-chiseled-trimmed-singlefile-invariant<span class="tag">&lt;/<span class="name">ContainerImageName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerImageTag</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">ContainerImageTag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContainerBaseImage</span>&gt;</span>mcr.microsoft.com/dotnet/nightly/runtime-deps:7.0-jammy-chiseled<span class="tag">&lt;/<span class="name">ContainerBaseImage</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">InvariantGlobalization</span>&gt;</span>true<span class="tag">&lt;/<span class="name">InvariantGlobalization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PublishTrimmed</span>&gt;</span>true<span class="tag">&lt;/<span class="name">PublishTrimmed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Finally, the image is <strong>48.3MB</strong> compared to the 48.4MB. We won 0.1MB.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> ‚ùØ  dotnet publish <span class="literal">--os</span> linux <span class="literal">--arch</span> x64 <span class="literal">-p</span>:PublishProfile=DefaultContainer <span class="literal">-c</span> Release <span class="literal">--self-contained</span> true <span class="literal">-p</span>:PublishSingleFile=true</span><br><span class="line"> ...</span><br><span class="line"> ‚ùØ  docker image list</span><br><span class="line">REPOSITORY                                            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">dotnet<span class="literal">-webapp-chiseled-trimmed-singlefile-invariant</span>   <span class="number">1.1</span>.<span class="number">0</span>     fd7c4aca6501   <span class="number">19</span> seconds ago   <span class="number">48.3</span>MB</span><br><span class="line">dotnet<span class="literal">-webapp-chiseled-trimmed-singlefile</span>             <span class="number">1.1</span>.<span class="number">0</span>     <span class="number">2643</span>c10fa1d9   <span class="number">8</span> minutes ago    <span class="number">48.4</span>MB</span><br><span class="line">dotnet<span class="literal">-webapp-chiseled-trimmed</span>                        <span class="number">1.1</span>.<span class="number">0</span>     df989eda0f7f   <span class="number">13</span> minutes ago   <span class="number">48.4</span>MB</span><br><span class="line">dotnet<span class="literal">-webapp-chiseled</span>                                <span class="number">1.1</span>.<span class="number">0</span>     a369967b535a   <span class="number">22</span> minutes ago   <span class="number">112</span>MB</span><br><span class="line">dotnet<span class="literal">-webapp-image</span>                                   <span class="number">1.1</span>.<span class="number">0</span>     d63f313397aa   <span class="number">38</span> minutes ago   <span class="number">216</span>MB</span><br><span class="line">webapp                                                <span class="number">1.0</span>.<span class="number">0</span>     e2d2de6a8878   <span class="number">39</span> minutes ago   <span class="number">216</span>MB</span><br></pre></td></tr></table></figure>

<p>I expected better results with this last step. The runtime-deps:6.0-jammy-chiseled <a target="_blank" rel="noopener" href="https://github.com/dotnet/dotnet-docker/blob/nightly/src/runtime-deps/6.0/jammy-chiseled/amd64/Dockerfile#L52-L53">removes ICU</a> and sets <code>DOTNET_SYSTEM_GLOBALIZATION_INVARIANT=true</code>. I guess runtime-deps:7.0-jammy-chiseled does the same, but the code is not yet available.</p>
<blockquote class="twitter-tweet" data-lang="en" data-dnt="true" data-theme="light"><p lang="en" dir="ltr">Hey <a target="_blank" rel="noopener" href="https://twitter.com/runfaster2000?ref_src=twsrc%5Etfw">@runfaster2000</a> and <a target="_blank" rel="noopener" href="https://twitter.com/ValentinViennot?ref_src=twsrc%5Etfw">@ValentinViennot</a> Great presentation during the <a target="_blank" rel="noopener" href="https://twitter.com/hashtag/dotnetConf?src=hash&amp;ref_src=twsrc%5Etfw">#dotnetConf</a> üëçüèº Any plan to ship another 7.0-jammy-chiseled without ICU?</p>&mdash; Laurent Kemp√© (@laurentkempe) <a target="_blank" rel="noopener" href="https://twitter.com/laurentkempe/status/1591729789345599488?ref_src=twsrc%5Etfw">November 13, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h1 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> ‚ùØ  docker run <span class="literal">--rm</span> <span class="literal">-it</span> <span class="literal">-p</span> <span class="number">8080</span>:<span class="number">80</span>  dotnet<span class="literal">-webapp-chiseled-trimmed-singlefile-invariant</span>:<span class="number">1.1</span>.<span class="number">0</span></span><br><span class="line">info: Microsoft.Hosting.Lifetime[<span class="number">14</span>]</span><br><span class="line">      Now listening on: http://[::]:<span class="number">80</span></span><br><span class="line">info: Microsoft.Hosting.Lifetime[<span class="number">0</span>]</span><br><span class="line">      Application started. Press Ctrl+C to shut down.</span><br><span class="line">info: Microsoft.Hosting.Lifetime[<span class="number">0</span>]</span><br><span class="line">      Hosting environment: Production</span><br><span class="line">info: Microsoft.Hosting.Lifetime[<span class="number">0</span>]</span><br><span class="line">      Content root path: /app</span><br></pre></td></tr></table></figure>

<p>Then you can browse to <a target="_blank" rel="noopener" href="http://localhost:8080/weatherforecast">http://localhost:8080/weatherforecast</a> to see </p>
<p><img src="/images/dotnet-webapp-chiseled-trimmed-singlefile-invariant.png" alt="dotnet-webapp-chiseled-trimmed-singlefile-invariant running"></p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Now that .NET 7 RTM shipped, we can leverage those new capabilities. It lets us create small and secure containers for our .NET applications easily.</p>
<p>We went from a first docker image of <strong>216MB</strong> to a final docker image of <strong>48.3MB</strong>. That‚Äôs more than a <strong>77% reduction in size</strong>.</p>
<p>I hope you enjoyed this post and learned something new that you want to try out. If you have any questions or comments, please leave them below. Thanks for reading!</p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><p></p>
<div style="text-align: left">
  <div class="github-card"
    data-user="laurentkempe"
    data-repo="ChiseledDocker"
    data-height="200"
    data-width="400"
    data-theme="default"
    data-target=""
    data-client-id=""
    data-client-secret=""
  ></div>
</div>
<script src="/github-card-lib/githubcard.js"></script>


<h1 id="Presentation"><a href="#Presentation" class="headerlink" title="Presentation"></a>Presentation</h1><h3 id="Using-NET-with-Chiseled-Ubuntu-Containers"><a href="#Using-NET-with-Chiseled-Ubuntu-Containers" class="headerlink" title="Using .NET with Chiseled Ubuntu Containers"></a>Using .NET with Chiseled Ubuntu Containers</h3><blockquote>
<p>Chiseled Ubuntu Containers are new and exciting. You‚Äôll see how easy it is to switch to using them with .NET and what the benefits are. We‚Äôll show using them at your desktop, deploying them to the cloud, and also making an evil hacker fail to compromise an app (that might otherwise succeed).</p>
</blockquote>
<p></p> 
<div class="video-container"><iframe src="https://www.youtube.com/embed/FLGFzlWF4Gs" frameborder="0" loading="lazy" allowfullscreen></iframe></div>

<h3 id="NET-in-Ubuntu-and-Chiseled-Containers-Canonical-amp-Microsoft"><a href="#NET-in-Ubuntu-and-Chiseled-Containers-Canonical-amp-Microsoft" class="headerlink" title=".NET in Ubuntu and Chiseled Containers - Canonical &amp; Microsoft"></a>.NET in Ubuntu and Chiseled Containers - Canonical &amp; Microsoft</p></h3><blockquote>
<p>Folks at Microsoft reached out to Canonical with a ‚Äúsimple‚Äù request, for Ubuntu distroless container images. The two companies partnered together to produce super small and secure container images, about 100MB smaller than regular container images. You can start using these images now, for much better performance.</p>
</blockquote>
<p></p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/pnsYc8GskCw" frameborder="0" loading="lazy" allowfullscreen></iframe></div>

<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/dotnet/dotnet-6-is-now-in-ubuntu-2204/#net-in-chiseled-ubuntu-containers">.NET in Chiseled Ubuntu Containers</a></li>
<li><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/dotnet/announcing-builtin-container-support-for-the-dotnet-sdk/">Announcing built-in container support for the .NET SDK</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/dotnet/core/whats-new/dotnet-7#publish-to-a-container">Publish to a container</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dotnet/sdk-container-builds">dotnet &#x2F; sdk-container-builds</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dotnet/runtime/blob/main/docs/design/features/globalization-invariant-mode.md">.NET Core Globalization Invariant Mode</a></li>
<li><a target="_blank" rel="noopener" href="https://devdevdev.net/">devdevdev.net</a></li>
</ul>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/NET-SDK/" rel="tag">.NET SDK</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/ASP-NET-Core/" rel="tag">ASP.NET Core</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Docker/" rel="tag">Docker</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2023/02/20/refactoring-huge-csharp-code-base-in-minutes/"
                    data-tooltip="Refactoring huge C# code base in minutes"
                    aria-label="PREVIOUS: Refactoring huge C# code base in minutes"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/10/31/experimenting-with-dotnet-7-wasm-and-wasi-on-docker/"
                    data-tooltip="Experimenting with .NET 7, WASM, and WASI on Docker"
                    aria-label="NEXT: Experimenting with .NET 7, WASM, and WASI on Docker"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2023 Laurent Kemp√©. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2023/02/20/refactoring-huge-csharp-code-base-in-minutes/"
                    data-tooltip="Refactoring huge C# code base in minutes"
                    aria-label="PREVIOUS: Refactoring huge C# code base in minutes"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/10/31/experimenting-with-dotnet-7-wasm-and-wasi-on-docker/"
                    data-tooltip="Experimenting with .NET 7, WASM, and WASI on Docker"
                    aria-label="NEXT: Experimenting with .NET 7, WASM, and WASI on Docker"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/"
                        aria-label="global.share_on_linkedin"
                    >
                        <i class="fab fa-linkedin" aria-hidden="true"></i><span>global.share_on_linkedin</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Laurent Kemp√©</h4>
        
            <div id="about-card-bio"><p>I am an experienced Team Leader &amp; Distinguished Solution Architect with a passion for shipping high-quality products by empowering development team and culture toward an agile mindset. I bring technical vision and strategy, leading engineering teams to move product, processes and architecture forward.</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Team Leader, Distinguished Solutions Architect</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Illzach, France
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('https://farm5.staticflickr.com/4437/37116073235_dda239221d_o.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-mb1ebmkusdioooykjgg40eekgvma7twcg6t3hhso17spp5c8vggo1gbrdrbf.min.js"></script>

<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'https://laurentkempe.com/2022/11/14/dotnet-7-sdk-built-in-container-support-and-ubuntu-chiseled/';
              
            this.page.identifier = '20221114014041';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'laurentkempe';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    




    </body>
</html>
