
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Laurent Kempé">
    <title>Service to service invocation with Dapr .NET SDK - Laurent Kempé</title>
    <meta name="author" content="Laurent Kempé">
    
    
        <link rel="icon" href="https://laurentkempe.com/assets/images/favicon.ico">
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Laurent Kempé","sameAs":["https://github.com/laurentkempe","https://bsky.app/profile/laurentkempe.com","https://twitter.com/laurentkempe","https://www.linkedin.com/in/laurentkempe","https://flickr.com/photos/laurentkempe/"],"image":"https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg"},"articleBody":"In the previous two posts, we tackled the way to start with Dapr and how to call services. In this one, we will see how we can leverage the Dapr .NET SDK to handle service to service calls.\n\nGetting started with Dapr for .NET Developers\nUsing Service Invocation from Dapr .NET SDK\n\n\n\nIntroductionThe example in this blog post is quite simple. It focuses on the main topic which is to see how you can do service to service invocation with Dapr .NET SDK. We have two services implemented in C# ASP.NET exposing REST API, one named proxy and the second backend. proxy is calling backend using Dapr .NET SDK.\nNote that both services could be implemented in different languages on different platforms, nevertheless, the principles would be the same.\nBackend serviceNothing special here, it is the normal WeatherService from the default webapi .NET template, in the project WeatherForecastService. We just start it using Dapr and expose it under the name backend. That’s one of the beauties of Dapr, you don’t need to change your service to expose through a Dapr sidecar.\nstart.ps11dapr.exe run --app-id backend --app-port 5000 --dapr-http-port 3500 --app-ssl dotnet run -- --urls=https://localhost:5000/ -p WeatherForecastService/WeatherForecastService.csproj\n\nAgain, we can access our web API using its URI, https://localhost:5000/swagger/index.html and https://localhost:5000/WeatherForecast/ but what we want is that it can be called through Dapr at http://localhost:3500/v1.0/invoke/backend/method/weatherforecast.\nProxy serviceHere is the interesting part of this post. The backend service call is encapsulated in a client interface in the project WeatherForecastProxyService.\nIWeatherForecastClient.cs1234public interface IWeatherForecastClient&#123;    Task&lt;IEnumerable&lt;WeatherForecast&gt;&gt; GetWeatherForecast(int count);&#125;\n\nThe implementation of the interface is straightforward and the interesting part is that it gets an HttpClient injected through its constructor which can call our backend service by using only the ‘&lt;method-name&gt;‘ of our service, in this case, weatherforecast.\nThe clear benefit is that the client only focuses on the API it is calling and not where it is located, this is delegated to backendHttpClient.\nWeatherForecastClient.cs1234567891011121314151617public class WeatherForecastClient : IWeatherForecastClient&#123;    private readonly HttpClient _backendHttpClient;    public WeatherForecastClient(HttpClient backendHttpClient)    &#123;        _backendHttpClient = backendHttpClient;    &#125;    public async Task&lt;IEnumerable&lt;WeatherForecast&gt;&gt; GetWeatherForecast(int count)    &#123;        var weatherForecasts =            await _backendHttpClient.GetFromJsonAsync&lt;List&lt;WeatherForecast&gt;&gt;(&quot;weatherforecast&quot;);        return weatherForecasts?.Take(count);    &#125;&#125;\n\nTo be able to inject the backendHttpClient into our client class we configure the ASP.NET IOC container, taking advantage of Dapr .NET SDK to create the HttpClient using the Dapr appid backend which was used to start our backend service through Dapr. This is the way that the HttpClient knows how to call our backend service and decoupling it from its real address, letting Dapr handle the resolution of its location.\nStartup.cs123456public void ConfigureServices(IServiceCollection services)&#123;    ...    services.AddSingleton&lt;IWeatherForecastClient, WeatherForecastClient&gt;(        _ =&gt; new WeatherForecastClient(DaprClient.CreateInvokeHttpClient(&quot;backend&quot;)));&#125;\n\nFinally, we are injecting the client interface into the proxy controller so that we can use it in the controller method and call our backend service\nWeatherForecastProxyController.cs1234567891011121314151617[ApiController][Route(&quot;[controller]&quot;)]public class WeatherForecastProxyController : ControllerBase&#123;    private readonly IWeatherForecastClient _weatherForecastClient;    public WeatherForecastProxyController(IWeatherForecastClient weatherForecastClient)    &#123;        _weatherForecastClient = weatherForecastClient;    &#125;    [HttpGet]    public async Task&lt;IEnumerable&lt;WeatherForecast&gt;&gt; Get(int count)    &#123;        return await _weatherForecastClient.GetWeatherForecast(count);    &#125;&#125;\n\nWe start it using Dapr and expose it under the name proxy.\nstart.ps11dapr.exe run --app-id proxy --app-port 5001 --dapr-http-port 3501 --app-ssl dotnet run -- --urls=https://localhost:5001/ -p WeatherForecastProxyService/WeatherForecastProxyService.csproj\n\nWe can also access the proxy web API using its URI, https://localhost:5001/swagger/index.html, and https://localhost:5001/WeatherForecastProxy?count=2 but what we want is that it can be called through Dapr too at http://localhost:3501/v1.0/invoke/proxy/method/weatherforecastproxy?count=2.\nStarting proxy and backend Dapr sidecarYou can use the start.ps1 PowerShell script if you have Windows Terminal installed, and it will display side by side both outputs in a new full-screen window. On the left is the proxy sidecar output and on the right the backend.\nCalling the proxyAs I wrote previously, you can access the proxy API through its Dapr sidecar at http://localhost:3501/v1.0/invoke/proxy/method/weatherforecastproxy?count=2.It is interesting to note that it is also accessible through the backend sidecar at http://localhost:3500/v1.0/invoke/proxy/method/weatherforecastproxy?count=2, notice the port number difference from 3501 to 3500.\nThis means that the Dapr runtime handles correctly the routing of our call to the correct service.\n\n\nHere is the result\n\nConclusionIn this post, we saw again how easy it is to get the advantage of Dapr and its Dapr .NET SDK to ease our developer work and focus on the functionalities of our application and delegate the infrastructure work to Dapr, in that case, the service location again.\nYou can get access to the code of this blog post on GitHub in the ServiceToService folder\n\n\n  \n\n\n\n\n","dateCreated":"2021-03-16T16:00:39+00:00","dateModified":"2025-03-06T07:02:43+00:00","datePublished":"2021-03-16T16:00:39+00:00","description":"In the previous two posts, we tackled the way to start with Dapr and how to call services. In this one, we will see how we can leverage the Dapr .NET SDK to handle service to service calls.\n\nGetting started with Dapr for .NET Developers\nUsing Service Invocation from Dapr .NET SDK\n","headline":"Service to service invocation with Dapr .NET SDK","image":["https://live.staticflickr.com/4399/36332910612_149b9735ec_q.jpg","https://live.staticflickr.com/4399/36332910612_10d4a7d2da_h.jpg"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/"},"publisher":{"@type":"Organization","name":"Laurent Kempé","sameAs":["https://github.com/laurentkempe","https://bsky.app/profile/laurentkempe.com","https://twitter.com/laurentkempe","https://www.linkedin.com/in/laurentkempe","https://flickr.com/photos/laurentkempe/"],"image":"https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg","logo":{"@type":"ImageObject","url":"https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg"}},"url":"https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/","keywords":".NET, ASP.NET Core, Dapr","thumbnailUrl":"https://live.staticflickr.com/4399/36332910612_149b9735ec_q.jpg"}</script>
    <meta name="description" content="In the previous two posts, we tackled the way to start with Dapr and how to call services. In this one, we will see how we can leverage the Dapr .NET SDK to handle service to service calls.  Getting s">
<meta property="og:type" content="blog">
<meta property="og:title" content="Service to service invocation with Dapr .NET SDK">
<meta property="og:url" content="https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/index.html">
<meta property="og:site_name" content="Laurent Kempé">
<meta property="og:description" content="In the previous two posts, we tackled the way to start with Dapr and how to call services. In this one, we will see how we can leverage the Dapr .NET SDK to handle service to service calls.  Getting s">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://live.staticflickr.com/65535/51034623513_011b0ca0c1_c.jpg">
<meta property="article:published_time" content="2021-03-16T16:00:39.000Z">
<meta property="article:modified_time" content="2025-03-06T07:02:43.626Z">
<meta property="article:author" content="Laurent Kempé">
<meta property="article:tag" content=".NET">
<meta property="article:tag" content="ASP.NET Core">
<meta property="article:tag" content="Dapr">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://live.staticflickr.com/65535/51034623513_011b0ca0c1_c.jpg">
<meta name="twitter:creator" content="@laurentkempe">
    
    
        
    
    
        <meta property="og:image" content="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg"/>
    
    
        <meta property="og:image" content="https://live.staticflickr.com/4399/36332910612_149b9735ec_q.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://live.staticflickr.com/4399/36332910612_149b9735ec_q.jpg"/>
    
    
        <meta property="og:image" content="https://live.staticflickr.com/4399/36332910612_10d4a7d2da_h.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://live.staticflickr.com/4399/36332910612_10d4a7d2da_h.jpg"/>
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-alkhnhioxdeqoqym0ivaqklnlbp9sj1chcb7nqwkmxdugpxbunrmdlv4nm06.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Laurent Kempé
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Laurent Kempé</h4>
                
                    <h5 class="sidebar-profile-bio"><p>I am an experienced Team Leader &amp; Distinguished Solution Architect with a passion for shipping high-quality products by empowering development team and culture toward an agile mindset. I bring technical vision and strategy, leading engineering teams to move product, processes and architecture forward.</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/presentations.html"
                            
                            rel="noopener"
                            title="Presentations"
                        >
                        <i class="sidebar-button-icon fa fa-file-powerpoint" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Presentations</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/about-laurent-kempe.html"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/laurentkempe"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://bsky.app/profile/laurentkempe.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Bluesky"
                        >
                        <i class="sidebar-button-icon fab fa-bluesky" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Bluesky</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/laurentkempe"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/laurentkempe"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://flickr.com/photos/laurentkempe/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Flickr"
                        >
                        <i class="sidebar-button-icon fab fa-flickr" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Flickr</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://feeds.feedburner.com/laurentkempe"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
        <div class="post-header-cover
                    text-left
                    post-header-cover--partial"
             style="background-image:url('https://live.staticflickr.com/4399/36332910612_10d4a7d2da_h.jpg');"
             data-behavior="5">
            
                <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Service to service invocation with Dapr .NET SDK
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2021-03-16T16:00:39+00:00">
	
		    Mar 16, 2021
    	
    </time>
    
</div>

    
</div>

            
        </div>

            <div id="main" data-behavior="5"
                 class="hasCover
                        hasCoverMetaIn
                        hasCoverCaption">
                
<article class="post">
    
        <span class="post-header-cover-caption caption">Matamata, Hobbiton, New Zealand</span>
    
    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>In the previous two posts, we tackled the way to start with Dapr and how to call services. In this one, we will see how we can leverage the Dapr .NET SDK to handle service to service calls.</p>
<ul>
<li><a href="https://laurentkempe.com/2021/03/09/getting-started-with-dapr-for-dotnet-developers/">Getting started with Dapr for .NET Developers</a></li>
<li><a href="https://laurentkempe.com/2021/03/11/using-service-invocation-from-dapr-dotnet-sdk/">Using Service Invocation from Dapr .NET SDK</a></li>
</ul>
<span id="more"></span>

<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>The example in this blog post is quite simple. It focuses on the main topic which is to see how you can do service to service invocation with Dapr .NET SDK. We have two services implemented in C# ASP.NET exposing REST API, one named <strong>proxy</strong> and the second <strong>backend</strong>. <strong>proxy</strong> is calling <strong>backend</strong> using Dapr .NET SDK.</p>
<p>Note that both services could be implemented in different languages on different platforms, nevertheless, the principles would be the same.</p>
<h1 id="Backend-service"><a href="#Backend-service" class="headerlink" title="Backend service"></a>Backend service</h1><p>Nothing special here, it is the normal WeatherService from the default webapi .NET template, in the project WeatherForecastService. We just start it using Dapr and expose it under the name <strong>backend</strong>. That’s one of the beauties of Dapr, you don’t need to change your service to expose through a Dapr sidecar.</p>
<figure class="highlight powershell"><figcaption><span>start.ps1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dapr.exe run <span class="literal">--app-id</span> backend <span class="literal">--app-port</span> <span class="number">5000</span> <span class="literal">--dapr-http-port</span> <span class="number">3500</span> <span class="literal">--app-ssl</span> dotnet run <span class="literal">--</span> <span class="literal">--urls</span>=https://localhost:<span class="number">5000</span>/ <span class="literal">-p</span> WeatherForecastService/WeatherForecastService.csproj</span><br></pre></td></tr></table></figure>

<p>Again, we can access our web API using its URI, <a target="_blank" rel="noopener" href="https://localhost:5000/swagger/index.html">https://localhost:5000/swagger/index.html</a> and <a target="_blank" rel="noopener" href="https://localhost:5000/WeatherForecast/">https://localhost:5000/WeatherForecast/</a> but what we want is that it can be called through Dapr at <a target="_blank" rel="noopener" href="http://localhost:3500/v1.0/invoke/backend/method/weatherforecast">http://localhost:3500/v1.0/invoke/backend/method/weatherforecast</a>.</p>
<h1 id="Proxy-service"><a href="#Proxy-service" class="headerlink" title="Proxy service"></a>Proxy service</h1><p>Here is the interesting part of this post. The <strong>backend</strong> service call is encapsulated in a client interface in the project WeatherForecastProxyService.</p>
<figure class="highlight csharp"><figcaption><span>IWeatherForecastClient.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IWeatherForecastClient</span></span><br><span class="line">&#123;</span><br><span class="line">    Task&lt;IEnumerable&lt;WeatherForecast&gt;&gt; GetWeatherForecast(<span class="built_in">int</span> count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The implementation of the interface is straightforward and the interesting part is that it gets an <em>HttpClient</em> injected through its constructor which can call our <strong>backend</strong> service by using only the ‘&lt;method-name&gt;‘ of our service, in this case, <em>weatherforecast</em>.</p>
<p>The clear benefit is that the client only focuses on the API it is calling and not where it is located, this is delegated to <em>backendHttpClient</em>.</p>
<figure class="highlight csharp"><figcaption><span>WeatherForecastClient.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WeatherForecastClient</span> : <span class="title">IWeatherForecastClient</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> HttpClient _backendHttpClient;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WeatherForecastClient</span>(<span class="params">HttpClient backendHttpClient</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _backendHttpClient = backendHttpClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;IEnumerable&lt;WeatherForecast&gt;&gt; GetWeatherForecast(<span class="built_in">int</span> count)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> weatherForecasts =</span><br><span class="line">            <span class="keyword">await</span> _backendHttpClient.GetFromJsonAsync&lt;List&lt;WeatherForecast&gt;&gt;(<span class="string">&quot;weatherforecast&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> weatherForecasts?.Take(count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To be able to inject the <strong>backendHttpClient</strong> into our client class we configure the ASP.NET IOC container, taking advantage of Dapr .NET SDK to create the HttpClient using the Dapr <strong>appid</strong> <em>backend</em> which was used to start our backend service through Dapr. This is the way that the <em>HttpClient</em> knows how to call our <strong>backend</strong> service and decoupling it from its real address, letting Dapr handle the resolution of its location.</p>
<figure class="highlight csharp"><figcaption><span>Startup.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    services.AddSingleton&lt;IWeatherForecastClient, WeatherForecastClient&gt;(</span><br><span class="line">        _ =&gt; <span class="keyword">new</span> WeatherForecastClient(DaprClient.CreateInvokeHttpClient(<span class="string">&quot;backend&quot;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, we are injecting the client interface into the proxy controller so that we can use it in the controller method and call our <strong>backend</strong> service</p>
<figure class="highlight csharp"><figcaption><span>WeatherForecastProxyController.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;[controller]&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WeatherForecastProxyController</span> : <span class="title">ControllerBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IWeatherForecastClient _weatherForecastClient;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WeatherForecastProxyController</span>(<span class="params">IWeatherForecastClient weatherForecastClient</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _weatherForecastClient = weatherForecastClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">HttpGet</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;IEnumerable&lt;WeatherForecast&gt;&gt; Get(<span class="built_in">int</span> count)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> _weatherForecastClient.GetWeatherForecast(count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We start it using Dapr and expose it under the name <strong>proxy</strong>.</p>
<figure class="highlight powershell"><figcaption><span>start.ps1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dapr.exe run <span class="literal">--app-id</span> proxy <span class="literal">--app-port</span> <span class="number">5001</span> <span class="literal">--dapr-http-port</span> <span class="number">3501</span> <span class="literal">--app-ssl</span> dotnet run <span class="literal">--</span> <span class="literal">--urls</span>=https://localhost:<span class="number">5001</span>/ <span class="literal">-p</span> WeatherForecastProxyService/WeatherForecastProxyService.csproj</span><br></pre></td></tr></table></figure>

<p>We can also access the proxy web API using its URI, <a target="_blank" rel="noopener" href="https://localhost:5001/swagger/index.html">https://localhost:5001/swagger/index.html</a>, and <a target="_blank" rel="noopener" href="https://localhost:5001/WeatherForecastProxy?count=2">https://localhost:5001/WeatherForecastProxy?count=2</a> but what we want is that it can be called through Dapr too at <a target="_blank" rel="noopener" href="http://localhost:3501/v1.0/invoke/proxy/method/weatherforecastproxy?count=2">http://localhost:3501/v1.0/invoke/proxy/method/weatherforecastproxy?count=2</a>.</p>
<h1 id="Starting-proxy-and-backend-Dapr-sidecar"><a href="#Starting-proxy-and-backend-Dapr-sidecar" class="headerlink" title="Starting proxy and backend Dapr sidecar"></a>Starting proxy and backend Dapr sidecar</h1><p>You can use the <code>start.ps1</code> PowerShell script if you have Windows Terminal installed, and it will display side by side both outputs in a new full-screen window. On the left is the <strong>proxy</strong> sidecar output and on the right the <strong>backend</strong>.</p>
<h1 id="Calling-the-proxy"><a href="#Calling-the-proxy" class="headerlink" title="Calling the proxy"></a>Calling the proxy</h1><p>As I wrote previously, you can access the <strong>proxy</strong> API through its Dapr sidecar at <a target="_blank" rel="noopener" href="http://localhost:3501/v1.0/invoke/proxy/method/weatherforecastproxy?count=2">http://localhost:3501/v1.0/invoke/proxy/method/weatherforecastproxy?count=2</a>.<br>It is interesting to note that it is also accessible through the <strong>backend</strong> sidecar at <a target="_blank" rel="noopener" href="http://localhost:3500/v1.0/invoke/proxy/method/weatherforecastproxy?count=2">http://localhost:3500/v1.0/invoke/proxy/method/weatherforecastproxy?count=2</a>, notice the port number difference from <em>3501</em> to <em>3500</em>.</p>
<div class="alert info"><p>This means that the Dapr runtime handles correctly the routing of our call to the correct service.</p>
</div>

<p>Here is the result</p>
<p><img src="https://live.staticflickr.com/65535/51034623513_011b0ca0c1_c.jpg" alt="Calling the proxy"></p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>In this post, we saw again how easy it is to get the advantage of <a target="_blank" rel="noopener" href="https://dapr.io/">Dapr</a> and its <a target="_blank" rel="noopener" href="https://github.com/dapr/dotnet-sdk">Dapr .NET SDK</a> to ease our developer work and focus on the functionalities of our application and delegate the infrastructure work to Dapr, in that case, the service location again.</p>
<p>You can get access to the code of this blog post on GitHub in the <a target="_blank" rel="noopener" href="https://github.com/laurentkempe/daprPlayground/tree/master/ServiceToService">ServiceToService folder</a></p>
<p></p>
<div style="text-align: left">
  <div class="github-card"
    data-user="laurentkempe"
    data-repo="daprPlayground"
    data-height="200"
    data-width="400"
    data-theme="default"
    data-target=""
    data-client-id=""
    data-client-secret=""
  ></div>
</div>
<script src="/github-card-lib/githubcard.js"></script>



            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/NET/" rel="tag">.NET</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/ASP-NET-Core/" rel="tag">ASP.NET Core</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Dapr/" rel="tag">Dapr</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/03/18/service-to-service-invocation-with-refit-and-dapr-dotnet-sdk/"
                    data-tooltip="Service to service invocation with Refit and Dapr .NET SDK"
                    aria-label="PREVIOUS: Service to service invocation with Refit and Dapr .NET SDK"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/03/11/using-service-invocation-from-dapr-dotnet-sdk/"
                    data-tooltip="Using Service Invocation from Dapr .NET SDK"
                    aria-label="NEXT: Using Service Invocation from Dapr .NET SDK"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Laurent Kempé. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/03/18/service-to-service-invocation-with-refit-and-dapr-dotnet-sdk/"
                    data-tooltip="Service to service invocation with Refit and Dapr .NET SDK"
                    aria-label="PREVIOUS: Service to service invocation with Refit and Dapr .NET SDK"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/03/11/using-service-invocation-from-dapr-dotnet-sdk/"
                    data-tooltip="Using Service Invocation from Dapr .NET SDK"
                    aria-label="NEXT: Using Service Invocation from Dapr .NET SDK"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/"
                        aria-label="global.share_on_linkedin"
                    >
                        <i class="fab fa-linkedin" aria-hidden="true"></i><span>global.share_on_linkedin</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Laurent Kempé</h4>
        
            <div id="about-card-bio"><p>I am an experienced Team Leader &amp; Distinguished Solution Architect with a passion for shipping high-quality products by empowering development team and culture toward an agile mindset. I bring technical vision and strategy, leading engineering teams to move product, processes and architecture forward.</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Team Leader, Distinguished Solutions Architect</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Illzach, France
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('https://farm5.staticflickr.com/4437/37116073235_dda239221d_o.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-sq5my1bekygdonhpwjskqccqqqvosf04e6bojhkyea67kgeai7hh2ljvmrsu.min.js"></script>

<!--SCRIPTS END-->



    




    </body>
</html>
