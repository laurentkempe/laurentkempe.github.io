
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Laurent Kemp√©">
    <title>Learning AI function calling in C# with Llama 3.2 SLM and Ollama running on your machine - Laurent Kemp√©</title>
    <meta name="author" content="Laurent Kemp√©">
    
    
        <link rel="icon" href="https://laurentkempe.com/assets/images/favicon.ico">
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Laurent Kemp√©","sameAs":["https://github.com/laurentkempe","https://bsky.app/profile/laurentkempe.com","https://twitter.com/laurentkempe","https://www.linkedin.com/in/laurentkempe","https://flickr.com/photos/laurentkempe/"],"image":"https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg"},"articleBody":"I‚Äôve been trying to wrap my head around function&#x2F;tool calling for a while now, and I‚Äôm excited to share what I‚Äôve learned with you. It‚Äôs a powerful way to let developers integrate advanced AI features directly into their applications. We‚Äôll walk through understanding the core concepts, setting up your environment, and implementing a practical example using a C# source generator.\n\n\nIntroductionAI function calling allows AI models, to interact with external tools or APIs by calling specific functions within their responses. This enables the AI to perform tasks that require real-time data or specific computations, which the model itself cannot directly handle.\nFor example, an AI model doesn‚Äôt know anything about the current weather in a specific location or the current time. By calling external functions, the AI can access the necessary data or perform the required computations to provide accurate and up-to-date information.\nUnderstanding the Core ConceptsWhen you provide a prompt to the AI model, you can also specify a set of functions that the model can use. The model can decide to generate a structured output that includes the function to call and the necessary parameters.\nFor example, if you ask for the weather in Illzach, France, and pass a function to get the weather, the model generate an output that includes a call to the weather function with ‚ÄúIllzach, France‚Äù as the parameter.\n1&#123;&quot;name&quot;: &quot;GetWeather&quot;, &quot;parameters&quot;: &#123;&quot;city&quot;: &quot;Illzach, France&quot;&#125;&#125;\n\nRequirementsTo use AI function calling, you typically need:\n\nSupported Models: Ensure the AI model you are using supports function calling\nFunction Definitions: Clearly defined functions that the AI can call, including the parameters they require\nIntegration Setup: Proper setup to handle the structured output from the AI and make the actual API calls\n\nWe will leverage\n\nLlama 3.2 SLM, a model supporting function calling\nC# source generator to easily define function definitions to pass to the AI model\nOllama to run the SLM and deal with the integration of all\n\nSetting Up Your EnvironmentTo get started with AI function calling in C#, you need\n\nInstall Ollama to run the SLM and handle the integration\nPull Llama 3.2 SLM model on your machine ollama pull llama3.2:3b\n\nImplementing a Practical ExampleLet‚Äôs walk through a practical example of AI function calling in C# using a simple time service. We‚Äôll define a function that takes a city name as a parameter and returns the current time.\n12string GetCurrentTime(string city) =&gt;     $&quot;It is &#123;DateTime.Now.Hour&#125;:&#123;DateTime.Now.Minute&#125; in &#123;city&#125;.&quot;;\n\nWe will need to pass a function description to the SLM model. We can use a C# attribute to achieve that goal.\n123[Function(&quot;Get the current time for a city&quot;)]public string GetCurrentTime(string city) =&gt;     $&quot;It is &#123;DateTime.Now.Hour&#125;:&#123;DateTime.Now.Minute&#125; in &#123;city&#125;.&quot;;\n\nThe Function attribute will be used by the C# source generator to generate the function description to pass to the SLM model. We need a partial class, so that the other part of the class is generated by the source generator.\n123456public sealed partial class Functions&#123;    [Function(&quot;Get the current time for a city&quot;)]    string GetCurrentTime(string city) =&gt;        $&quot;It is &#123;DateTime.Now.Hour&#125;:&#123;DateTime.Now.Minute&#125; in &#123;city&#125;.&quot;;&#125;\n\nThe source generator will generate the following code.\n12345678partial class Functions&#123;    public List&lt;FunctionDetails&gt; GetFunctionDetails() =&gt;    [         new(&quot;GetCurrentTime&quot;,             new FunctionParameters(&quot;city&quot;), &quot;Get the current time for a city&quot;)    ];&#125;\n\nand it will also generate FunctionDetails and FunctionParameters\n1234567public record FunctionDetails(    [property: JsonPropertyName(&quot;name&quot;)] string Name,    [property: JsonPropertyName(&quot;parameters&quot;)] FunctionParameters FunctionParameters,    string Description);public record FunctionParameters([property: JsonPropertyName(&quot;city&quot;)] string City);\n\nNote that the source generator is not handling the parameter and we currently hardcode the parameter name city in the FunctionParameters record. I leave that as an exercise for the reader to improve the source generator to handle multiple parameters and their types.\n\n\nWe are now able to provide a prompt to the AI model specifying functions that the model can use. To simplify this, we created ChatRequestBuilder allowing to build an OllamaSharp ChatRequest with the user prompt, defining the model and the functions.\n123456var functions = new Functions();var request = new ChatRequestBuilder()    .SetModel(&quot;llama3.2:3b&quot;)    .AddMessage(userMessage, &quot;user&quot;)    .AddFunctions(functions)    .Build();\n\nYou find the whole source code for ChatRequestBuilder in my aiPlayground repository.\nWe can call OllamaSharp Chat API to get the json response from the AI model.\n1234567891011var jsonBuilder = new StringBuilder();// üëáüèº Calling OllamaSharp Chat and getting the response streamed backvar ollamaApiClient = new OllamaApiClient(new Uri(&quot;http://localhost:11434&quot;));await foreach (var responseStream in ollamaApiClient.Chat(request))&#123;    jsonBuilder.Append(responseStream?.Message.Content);&#125;Console.WriteLine($&quot;User message: &#123;userMessage&#125;&quot;);var json = jsonBuilder.ToString();Console.WriteLine($&quot;Received from SLM: &#123;json&#125;&quot;);\n\nIt is finally time to parse the json response and call the function.\n12var result = functions.Execute(JsonSerializer.Deserialize&lt;FunctionDetails&gt;(json));Console.WriteLine($&quot;Function calling result: \\&quot;&#123;result&#125;\\&quot;&quot;);\n\nTo achieve that we need to add the Execute method to the Functions class generated using the C# source code generator.\n12345678910111213141516partial class Functions&#123;    public string Execute(FunctionDetails? function)    &#123;        return function?.Name switch         &#123;            &quot;GetCurrentTime&quot; =&gt; GetCurrentTime(function.FunctionParameters.City)        &#125;;    &#125;        public List&lt;FunctionDetails&gt; GetFunctionDetails() =&gt;    [        new(&quot;GetCurrentTime&quot;,            new FunctionParameters(&quot;city&quot;), &quot;Get the current time for a city&quot;)    ];&#125;\n\nRunning the application will output the following\n123User message: What time is it in Illzach, France?Received from SLM: &#123;&quot;name&quot;: &quot;GetCurrentTime&quot;,&quot;parameters&quot;: &#123;&quot;city&quot;: &quot;Illzach, France&quot;&#125;&#125;Function calling result: &quot;It is 9:53 in Illzach, France.&quot;\n\nGlimpse into the C# source code generatorThe source generator is a C# feature that allows you to generate additional C# source files at compile time. It can be used to automate repetitive tasks, reduce boilerplate code, and improve performance by generating code that would otherwise be written manually. In our case, we create a source generator implementing IIncrementalGenerator.\nFirst, we need to create the FunctionAttribute defining the Description of the function to call.\n12345678910111213141516171819202122private const string Namespace = &quot;Generators&quot;;private const string AttributeName = &quot;FunctionAttribute&quot;;/*lang=cs*/private const string AttributeSourceCode =     $$&quot;&quot;&quot;        // &lt;auto-generated/&gt;        namespace &#123;&#123;Namespace&#125;&#125;        &#123;            [System.AttributeUsage(System.AttributeTargets.Method)]            public class &#123;&#123;AttributeName&#125;&#125; : System.Attribute            &#123;                public string Description &#123; get; &#125;                        public FunctionAttribute(string description)                &#123;                    Description = description;                &#125;            &#125;        &#125;        &quot;&quot;&quot;;\n\nand a method generating a new source file FunctionAttribute.g.cs with the FunctionAttribute source code.\n123456private static void AddMarkerAttributeToCompilation(IncrementalGeneratorInitializationContext context) &#123;    context.RegisterPostInitializationOutput(ctx =&gt; ctx.AddSource(        &quot;FunctionAttribute.g.cs&quot;,        SourceText.From(AttributeSourceCode, Encoding.UTF8)));&#125;\n\nWe do the same for FunctionDetails and FunctionParameters records.\n123456789101112131415161718192021222324252627282930313233343536373839/*lang=cs*/private const string FunctionDetailsSourceCode =     $$&quot;&quot;&quot;        // &lt;auto-generated/&gt;        namespace &#123;&#123;Namespace&#125;&#125;        &#123;            public record FunctionDetails(                [property: JsonPropertyName(&quot;name&quot;)] string Name,                [property: JsonPropertyName(&quot;parameters&quot;)] FunctionParameters FunctionParameters,                string Description            );        &#125;        &quot;&quot;&quot;;/*lang=cs*/private const string FunctionParametersSourceCode =     $$&quot;&quot;&quot;        // &lt;auto-generated/&gt;        namespace &#123;&#123;Namespace&#125;&#125;        &#123;        public record FunctionParameters([property: JsonPropertyName(&quot;city&quot;)] string City);        &#125;        &quot;&quot;&quot;;private static void AddFunctionDetailsToCompilation(IncrementalGeneratorInitializationContext context)&#123;    context.RegisterPostInitializationOutput(ctx =&gt; ctx.AddSource(        &quot;FunctionDetails.g.cs&quot;,        SourceText.From(FunctionDetailsSourceCode, Encoding.UTF8)));&#125;private static void AddFunctionParametersToCompilation(IncrementalGeneratorInitializationContext context)  &#123;    context.RegisterPostInitializationOutput(ctx =&gt; ctx.AddSource(        &quot;FunctionParameters.g.cs&quot;,        SourceText.From(FunctionParametersSourceCode, Encoding.UTF8)));&#125;\nIt is time to implement void Initialize(IncrementalGeneratorInitializationContext context) from IIncrementalGenerator interface. It will add the FunctionAttribute, FunctionDetails, and FunctionParameters to the compilation. Then it will get all methods decorated with the FunctionAttribute and generate the source code.\n123456789101112131415161718public void Initialize(IncrementalGeneratorInitializationContext context)&#123;    AddMarkerAttributeToCompilation(context);    AddFunctionDetailsToCompilation(context);    AddFunctionParametersToCompilation(context);    // üëáüèº Filter classes annotated with the [Function] attribute. Only filtered Syntax Nodes can trigger code generation.      var provider = context.SyntaxProvider        .CreateSyntaxProvider(            (s, _) =&gt; s is MethodDeclarationSyntax,            (ctx, _) =&gt; GetMethodDeclarationForSourceGen(ctx))        .Where(t =&gt; t.functionAttributeFound)        .Select((t, _) =&gt; t.Item1);    // üëáüèº Generate the source code.    context.RegisterSourceOutput(context.CompilationProvider.Combine(provider.Collect()),        (ctx, t) =&gt; GenerateCode(ctx, t.Left, t.Right));&#125;\n\nWe need to find the MethodDeclarationSyntax decorated with the FunctionAttribute.\n123456789101112131415161718192021private static (MethodDeclarationSyntax, bool functionAttributeFound) GetMethodDeclarationForSourceGen(    GeneratorSyntaxContext context)&#123;    var methodDeclarationSyntax = (MethodDeclarationSyntax)context.Node;    // üëáüèº Go through all attributes of the class.    foreach (var attributeListSyntax in methodDeclarationSyntax.AttributeLists)    foreach (var attributeSyntax in attributeListSyntax.Attributes)    &#123;        if (context.SemanticModel.GetSymbolInfo(attributeSyntax).Symbol is not IMethodSymbol attributeSymbol)              continue; // if we can&#x27;t get the symbol, ignore it        var attributeName = attributeSymbol.ContainingType.ToDisplayString();        // üëáüèº Check the full name of the [Function] attribute.        if (attributeName == $&quot;&#123;Namespace&#125;.&#123;AttributeName&#125;&quot;)            return (methodDeclarationSyntax, true);    &#125;    return (methodDeclarationSyntax, false);&#125;\n\nFinally, we generate the source code for the partial Functions class.\n123456789101112131415161718192021222324252627282930313233343536373839private static void GenerateCode(SourceProductionContext context,                                 ImmutableArray&lt;MethodDeclarationSyntax&gt; methodDeclarations)&#123;    var partialClassName = &quot;&quot;;    if (methodDeclarations.First().Parent is ClassDeclarationSyntax classDeclarationSyntax)        partialClassName = classDeclarationSyntax.Identifier.Text;    var (functionNamePatternMatching, functionDetails) =        GenerateFunctionDetails(methodDeclarations);    /*lang=cs*/    var partialClassCode =        $$$&quot;&quot;&quot;            // &lt;auto-generated/&gt;            using System;            using System.Collections.Generic;            partial class &#123;&#123;&#123;partialClassName&#125;&#125;&#125;            &#123;                public string Execute(FunctionDetails? function)                &#123;                    return function?.Name switch                     &#123;                        &#123;&#123;&#123;functionNamePatternMatching&#125;&#125;&#125;                    &#125;;                &#125;                                public List&lt;FunctionDetails&gt; GetFunctionDetails() =&gt;                [                    &#123;&#123;&#123;functionDetails&#125;&#125;&#125;                ];            &#125;            &quot;&quot;&quot;;    // Add the source code to the compilation.    context.AddSource($&quot;&#123;partialClassName&#125;.g.cs&quot;,                       SourceText.From(partialClassCode, Encoding.UTF8));&#125;\n\nTo generate the code we need to extract the function descriptions and names.\n1234567891011121314151617181920212223242526private static List&lt;(string name, string description)&gt; ExtractFunctionDescriptions(    ImmutableArray&lt;MethodDeclarationSyntax&gt; methodDeclarations)&#123;    var functionNames = new List&lt;(string name, string description)&gt;();    // Go through all filtered method declarations.    foreach (var methodDeclarationSyntax in methodDeclarations)    &#123;        // üëáüèº Get attribute property called Function from methodDeclarationSyntax        var attributeSyntax = methodDeclarationSyntax.AttributeLists            .SelectMany(x =&gt; x.Attributes)            .First(x =&gt; x.Name.ToString() == &quot;Function&quot;);        var descriptionArgument = attributeSyntax.ArgumentList?.Arguments.First();        if (descriptionArgument == null) continue;                // üëáüèº Get attribute Description property        var descriptionLiteral = (LiteralExpressionSyntax)descriptionArgument.Expression;        var descriptionValue = descriptionLiteral.Token.ValueText;        functionNames.Add(            new ValueTuple&lt;string, string&gt;(methodDeclarationSyntax.Identifier.Text, descriptionValue));    &#125;    return functionNames;&#125;\n\nAnd create the function details and function name pattern matching.\n1234567891011121314151617181920212223private static (StringBuilder functionNamePatternMatching, StringBuilder functionDetails) GenerateFunctionDetails(    ImmutableArray&lt;MethodDeclarationSyntax&gt; methodDeclarations)&#123;    StringBuilder functionNamePatternMatching = new();    StringBuilder functionDetails = new();    List&lt;(string name, string description)&gt; functionNames = ExtractFunctionDescriptions(methodDeclarations);         for (var i = 0; i &lt; functionNames.Count; i++)    &#123;        var functionNamesIndex = functionNames.Count - 1;        var separator = i &lt; functionNamesIndex ? &quot;,&quot; : &quot;&quot;;        var indentFunctionName = i &lt; functionNamesIndex ? &quot;&quot; : &quot;             &quot;;        var indentFunctionDetails = i &lt; functionNamesIndex ? &quot;&quot; : &quot;        &quot;;        var newLine = i &lt; functionNamesIndex ? &quot;\\n&quot; : &quot;&quot;;        functionNamePatternMatching.Append(            $&quot;&#123;indentFunctionName&#125;\\&quot;&#123;functionNames[i].name&#125;\\&quot; =&gt; &#123;functionNames[i].name&#125;(function.FunctionParameters.City)&#123;separator&#125;&#123;newLine&#125;&quot;);          functionDetails.Append(            $&quot;&#123;indentFunctionDetails&#125;new(\\&quot;&#123;functionNames[i].name&#125;\\&quot;, new FunctionParameters(\\&quot;city\\&quot;), \\&quot;&#123;functionNames[i].description&#125;\\&quot;)&#123;separator&#125;&#123;newLine&#125;&quot;);      &#125;    return (functionNamePatternMatching, functionDetails);&#125;\n\nResultFrom our function declaration\n1234567891011// üëáüèº Partial class annotated with the [Function] attribute used to generate functions.public sealed partial class Functions&#123;    [Function(&quot;Get the current time for a city&quot;)]    string GetCurrentTime(string city) =&gt;        $&quot;It is &#123;DateTime.Now.Hour&#125;:&#123;DateTime.Now.Minute&#125; in &#123;city&#125;.&quot;;    [Function(&quot;Get the current weather for a city&quot;)]    string GetCurrentWeather(string city) =&gt;        &quot;The weather in &quot; + city + &quot; is sunny.&quot;;&#125;\n\nWe generate the following code\n12345678910111213141516171819202122// &lt;auto-generated/&gt;using System;using System.Collections.Generic;partial class Functions&#123;    public string Execute(FunctionDetails? function)    &#123;        return function?.Name switch         &#123;             &quot;GetCurrentTime&quot; =&gt; GetCurrentTime(function.FunctionParameters.City),             &quot;GetCurrentWeather&quot; =&gt; GetCurrentWeather(function.FunctionParameters.City)        &#125;;    &#125;        public List&lt;FunctionDetails&gt; GetFunctionDetails() =&gt;    [        new(&quot;GetCurrentTime&quot;, new FunctionParameters(&quot;city&quot;), &quot;Get the current time for a city&quot;),        new(&quot;GetCurrentWeather&quot;, new FunctionParameters(&quot;city&quot;), &quot;Get the current weather for a city&quot;)      ];&#125;\n\nConclusionAI function&#x2F;tool calling is a powerful tool that allows AI models to interact with external tools and APIs, enabling them to perform complex tasks that require real-time data or specific computations. By understanding the core concepts and setting up your environment correctly, you can easily integrate AI-driven functionality into your C# projects, enhancing their capabilities.\nI hope this tutorial has provided you with a clear understanding of AI function calling in C# and how you can get started with it.\nReferences\nOllamaSharp\nOllama\nOllama Tool support\nLlama 3.2 SLM\nCreating an incremental generator\nDeveloping Source Generators in C#\n\nGet the source code on GitHub laurentkempe&#x2F;aiPlayground&#x2F;OllamaToolConsoleApp.\n\n\n  \n\n\n\n\n","dateCreated":"2024-10-28T16:22:35+00:00","dateModified":"2025-03-01T14:17:55+00:00","datePublished":"2024-10-28T16:22:35+00:00","description":"I‚Äôve been trying to wrap my head around function&#x2F;tool calling for a while now, and I‚Äôm excited to share what I‚Äôve learned with you. It‚Äôs a powerful way to let developers integrate advanced AI features directly into their applications. We‚Äôll walk through understanding the core concepts, setting up your environment, and implementing a practical example using a C# source generator.","headline":"Learning AI function calling in C# with Llama 3.2 SLM and Ollama running on your machine","image":["https://live.staticflickr.com/4303/36283818966_e3fb80e9eb_q.jpg","https://live.staticflickr.com/4303/36283818966_6ff2197d3e_h.jpg"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://laurentkempe.com/2024/10/28/learning-ai-function-calling-in-csharp-with-llama-32-slm-and-ollama-running-on-your-machine/"},"publisher":{"@type":"Organization","name":"Laurent Kemp√©","sameAs":["https://github.com/laurentkempe","https://bsky.app/profile/laurentkempe.com","https://twitter.com/laurentkempe","https://www.linkedin.com/in/laurentkempe","https://flickr.com/photos/laurentkempe/"],"image":"https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg","logo":{"@type":"ImageObject","url":"https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg"}},"url":"https://laurentkempe.com/2024/10/28/learning-ai-function-calling-in-csharp-with-llama-32-slm-and-ollama-running-on-your-machine/","keywords":"C#, AI, LLM, Ollama, SLM","thumbnailUrl":"https://live.staticflickr.com/4303/36283818966_e3fb80e9eb_q.jpg"}</script>
    <meta name="description" content="I‚Äôve been trying to wrap my head around function&#x2F;tool calling for a while now, and I‚Äôm excited to share what I‚Äôve learned with you. It‚Äôs a powerful way to let developers integrate advanced AI fea">
<meta property="og:type" content="blog">
<meta property="og:title" content="Learning AI function calling in C# with Llama 3.2 SLM and Ollama running on your machine">
<meta property="og:url" content="https://laurentkempe.com/2024/10/28/learning-ai-function-calling-in-csharp-with-llama-32-slm-and-ollama-running-on-your-machine/index.html">
<meta property="og:site_name" content="Laurent Kemp√©">
<meta property="og:description" content="I‚Äôve been trying to wrap my head around function&#x2F;tool calling for a while now, and I‚Äôm excited to share what I‚Äôve learned with you. It‚Äôs a powerful way to let developers integrate advanced AI fea">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-10-28T16:22:35.000Z">
<meta property="article:modified_time" content="2025-03-01T14:17:55.820Z">
<meta property="article:author" content="Laurent Kemp√©">
<meta property="article:tag" content="C#">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="LLM">
<meta property="article:tag" content="Ollama">
<meta property="article:tag" content="SLM">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@laurentkempe">
    
    
        
    
    
        <meta property="og:image" content="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg"/>
    
    
        <meta property="og:image" content="https://live.staticflickr.com/4303/36283818966_e3fb80e9eb_q.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://live.staticflickr.com/4303/36283818966_e3fb80e9eb_q.jpg"/>
    
    
        <meta property="og:image" content="https://live.staticflickr.com/4303/36283818966_6ff2197d3e_h.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://live.staticflickr.com/4303/36283818966_6ff2197d3e_h.jpg"/>
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-60m2xxs5n9cax0mvqf40oo8jndukrbb2mrg9nqjv8ktrrxi8ud3r4gdvov2r.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Laurent Kemp√©
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Laurent Kemp√©</h4>
                
                    <h5 class="sidebar-profile-bio"><p>I am an experienced Team Leader &amp; Distinguished Solution Architect with a passion for shipping high-quality products by empowering development team and culture toward an agile mindset. I bring technical vision and strategy, leading engineering teams to move product, processes and architecture forward.</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/presentations.html"
                            
                            rel="noopener"
                            title="Presentations"
                        >
                        <i class="sidebar-button-icon fa fa-file-powerpoint" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Presentations</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/about-laurent-kempe.html"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/laurentkempe"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://bsky.app/profile/laurentkempe.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Bluesky"
                        >
                        <i class="sidebar-button-icon fab fa-bluesky" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Bluesky</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/laurentkempe"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/laurentkempe"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://flickr.com/photos/laurentkempe/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Flickr"
                        >
                        <i class="sidebar-button-icon fab fa-flickr" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Flickr</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://feeds.feedburner.com/laurentkempe"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
        <div class="post-header-cover
                    text-left
                    post-header-cover--partial"
             style="background-image:url('https://live.staticflickr.com/4303/36283818966_6ff2197d3e_h.jpg');"
             data-behavior="5">
            
                <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Learning AI function calling in C# with Llama 3.2 SLM and Ollama running on your machine
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2024-10-28T16:22:35+00:00">
	
		    Oct 28, 2024
    	
    </time>
    
</div>

    
</div>

            
        </div>

            <div id="main" data-behavior="5"
                 class="hasCover
                        hasCoverMetaIn
                        hasCoverCaption">
                
<article class="post">
    
        <span class="post-header-cover-caption caption">Mona Vale, New South Wales, Australia</span>
    
    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>I‚Äôve been trying to wrap my head around function&#x2F;tool calling for a while now, and I‚Äôm excited to share what I‚Äôve learned with you. It‚Äôs a powerful way to let developers integrate advanced AI features directly into their applications. We‚Äôll walk through understanding the core concepts, setting up your environment, and implementing a practical example using a C# source generator.</p>
<span id="more"></span>

<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>AI function calling allows AI models, to interact with external tools or APIs by calling specific functions within their responses. This enables the AI to perform tasks that require real-time data or specific computations, which the model itself cannot directly handle.</p>
<p>For example, an AI model doesn‚Äôt know anything about the current weather in a specific location or the current time. By calling external functions, the AI can access the necessary data or perform the required computations to provide accurate and up-to-date information.</p>
<h1 id="Understanding-the-Core-Concepts"><a href="#Understanding-the-Core-Concepts" class="headerlink" title="Understanding the Core Concepts"></a>Understanding the Core Concepts</h1><p>When you provide a prompt to the AI model, you can also specify a set of functions that the model can use. The model can decide to generate a structured output that includes the function to call and the necessary parameters.</p>
<p>For example, if you ask for the weather in Illzach, France, and pass a function to get the weather, the model generate an output that includes a call to the weather function with ‚ÄúIllzach, France‚Äù as the parameter.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GetWeather&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;city&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Illzach, France&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h1><p>To use AI function calling, you typically need:<br><br/></p>
<ul>
<li>Supported Models: Ensure the AI model you are using supports function calling</li>
<li>Function Definitions: Clearly defined functions that the AI can call, including the parameters they require</li>
<li>Integration Setup: Proper setup to handle the structured output from the AI and make the actual API calls</li>
</ul>
<p>We will leverage<br><br/></p>
<ul>
<li><strong>Llama 3.2 SLM</strong>, a model supporting function calling</li>
<li><strong>C# source generator</strong> to easily define function definitions to pass to the AI model</li>
<li><strong>Ollama</strong> to run the SLM and deal with the integration of all</li>
</ul>
<h1 id="Setting-Up-Your-Environment"><a href="#Setting-Up-Your-Environment" class="headerlink" title="Setting Up Your Environment"></a>Setting Up Your Environment</h1><p>To get started with AI function calling in C#, you need<br><br/></p>
<ul>
<li>Install <a target="_blank" rel="noopener" href="https://www.ollama.com/">Ollama</a> to run the SLM and handle the integration</li>
<li>Pull Llama 3.2 SLM model on your machine <code>ollama pull llama3.2:3b</code></li>
</ul>
<h1 id="Implementing-a-Practical-Example"><a href="#Implementing-a-Practical-Example" class="headerlink" title="Implementing a Practical Example"></a>Implementing a Practical Example</h1><p>Let‚Äôs walk through a practical example of AI function calling in C# using a simple time service. We‚Äôll define a function that takes a city name as a parameter and returns the current time.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">GetCurrentTime</span>(<span class="params"><span class="built_in">string</span> city</span>)</span> =&gt; </span><br><span class="line">    <span class="string">$&quot;It is <span class="subst">&#123;DateTime.Now.Hour&#125;</span>:<span class="subst">&#123;DateTime.Now.Minute&#125;</span> in <span class="subst">&#123;city&#125;</span>.&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>We will need to pass a function description to the SLM model. We can use a C# attribute to achieve that goal.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Function(<span class="string">&quot;Get the current time for a city&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetCurrentTime</span>(<span class="params"><span class="built_in">string</span> city</span>)</span> =&gt; </span><br><span class="line">    <span class="string">$&quot;It is <span class="subst">&#123;DateTime.Now.Hour&#125;</span>:<span class="subst">&#123;DateTime.Now.Minute&#125;</span> in <span class="subst">&#123;city&#125;</span>.&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>The <code>Function</code> attribute will be used by the C# source generator to generate the function description to pass to the SLM model. We need a partial class, so that the other part of the class is generated by the source generator.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">Functions</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Function(<span class="string">&quot;Get the current time for a city&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">GetCurrentTime</span>(<span class="params"><span class="built_in">string</span> city</span>)</span> =&gt;</span><br><span class="line">        <span class="string">$&quot;It is <span class="subst">&#123;DateTime.Now.Hour&#125;</span>:<span class="subst">&#123;DateTime.Now.Minute&#125;</span> in <span class="subst">&#123;city&#125;</span>.&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The source generator will generate the following code.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">Functions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;FunctionDetails&gt; <span class="title">GetFunctionDetails</span>()</span> =&gt;</span><br><span class="line">    [</span><br><span class="line">         <span class="keyword">new</span>(<span class="string">&quot;GetCurrentTime&quot;</span>, </span><br><span class="line">            <span class="keyword">new</span> FunctionParameters(<span class="string">&quot;city&quot;</span>), <span class="string">&quot;Get the current time for a city&quot;</span>)</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and it will also generate <code>FunctionDetails</code> and <code>FunctionParameters</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">record</span> <span class="title">FunctionDetails</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    [property: JsonPropertyName(<span class="string">&quot;name&quot;</span></span>)] <span class="built_in">string</span> Name,</span></span><br><span class="line"><span class="function">    [property: <span class="title">JsonPropertyName</span>(<span class="params"><span class="string">&quot;parameters&quot;</span></span>)] FunctionParameters FunctionParameters,</span></span><br><span class="line"><span class="function">    <span class="built_in">string</span> Description</span></span><br><span class="line"><span class="function">)</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">record</span> <span class="title">FunctionParameters</span>(<span class="params">[property: JsonPropertyName(<span class="string">&quot;city&quot;</span></span>)] <span class="built_in">string</span> City)</span>;</span><br></pre></td></tr></table></figure>

<div class="alert info"><p>Note that the source generator is not handling the parameter and we currently hardcode the parameter name <code>city</code> in the <code>FunctionParameters</code> record. I leave that as an exercise for the reader to improve the source generator to handle multiple parameters and their types.</p>
</div>

<p>We are now able to provide a prompt to the AI model specifying functions that the model can use. To simplify this, we created <code>ChatRequestBuilder</code> allowing to build an OllamaSharp <code>ChatRequest</code> with the user prompt, defining the model and the functions.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> functions = <span class="keyword">new</span> Functions();</span><br><span class="line"><span class="keyword">var</span> request = <span class="keyword">new</span> ChatRequestBuilder()</span><br><span class="line">    .SetModel(<span class="string">&quot;llama3.2:3b&quot;</span>)</span><br><span class="line">    .AddMessage(userMessage, <span class="string">&quot;user&quot;</span>)</span><br><span class="line">    .AddFunctions(functions)</span><br><span class="line">    .Build();</span><br></pre></td></tr></table></figure>

<p>You find the whole source code for <code>ChatRequestBuilder</code> in my <a target="_blank" rel="noopener" href="https://github.com/laurentkempe/aiPlayground/">aiPlayground</a> repository.</p>
<p>We can call OllamaSharp Chat API to get the json response from the AI model.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line"><span class="comment">// üëáüèº Calling OllamaSharp Chat and getting the response streamed back</span></span><br><span class="line"><span class="keyword">var</span> ollamaApiClient = <span class="keyword">new</span> OllamaApiClient(<span class="keyword">new</span> Uri(<span class="string">&quot;http://localhost:11434&quot;</span>));</span><br><span class="line"><span class="keyword">await</span> <span class="keyword">foreach</span> (<span class="keyword">var</span> responseStream <span class="keyword">in</span> ollamaApiClient.Chat(request))</span><br><span class="line">&#123;</span><br><span class="line">    jsonBuilder.Append(responseStream?.Message.Content);</span><br><span class="line">&#125;</span><br><span class="line">Console.WriteLine(<span class="string">$&quot;User message: <span class="subst">&#123;userMessage&#125;</span>&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> json = jsonBuilder.ToString();</span><br><span class="line">Console.WriteLine(<span class="string">$&quot;Received from SLM: <span class="subst">&#123;json&#125;</span>&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>It is finally time to parse the json response and call the function.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = functions.Execute(JsonSerializer.Deserialize&lt;FunctionDetails&gt;(json));</span><br><span class="line">Console.WriteLine(<span class="string">$&quot;Function calling result: \&quot;<span class="subst">&#123;result&#125;</span>\&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>To achieve that we need to add the <code>Execute</code> method to the <code>Functions</code> class generated using the C# source code generator.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">Functions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Execute</span>(<span class="params">FunctionDetails? function</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> function?.Name <span class="keyword">switch</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;GetCurrentTime&quot;</span> =&gt; GetCurrentTime(function.FunctionParameters.City)</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;FunctionDetails&gt; <span class="title">GetFunctionDetails</span>()</span> =&gt;</span><br><span class="line">    [</span><br><span class="line">        <span class="keyword">new</span>(<span class="string">&quot;GetCurrentTime&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> FunctionParameters(<span class="string">&quot;city&quot;</span>), <span class="string">&quot;Get the current time for a city&quot;</span>)</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Running the application will output the following</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User message: What time is it <span class="keyword">in</span> Illzach, France?</span><br><span class="line">Received from SLM: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;GetCurrentTime&quot;</span>,<span class="string">&quot;parameters&quot;</span>: &#123;<span class="string">&quot;city&quot;</span>: <span class="string">&quot;Illzach, France&quot;</span>&#125;&#125;</span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">calling</span> <span class="title">result</span>: &quot;<span class="title">It</span> <span class="title">is</span> <span class="title">9</span>:<span class="title">53</span> <span class="title">in</span> <span class="title">Illzach</span>, <span class="title">France</span>.&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="Glimpse-into-the-C-source-code-generator"><a href="#Glimpse-into-the-C-source-code-generator" class="headerlink" title="Glimpse into the C# source code generator"></a>Glimpse into the C# source code generator</h1><p>The source generator is a C# feature that allows you to generate additional C# source files at compile time. It can be used to automate repetitive tasks, reduce boilerplate code, and improve performance by generating code that would otherwise be written manually. In our case, we create a source generator implementing <code>IIncrementalGenerator</code>.</p>
<p>First, we need to create the <code>FunctionAttribute</code> defining the <code>Description</code> of the function to call.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> Namespace = <span class="string">&quot;Generators&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> AttributeName = <span class="string">&quot;FunctionAttribute&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*lang=cs*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> AttributeSourceCode = </span><br><span class="line">    $<span class="string">$&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        // &lt;auto-generated/&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        namespace &#123;&#123;Namespace&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            [System.AttributeUsage(System.AttributeTargets.Method)]</span></span><br><span class="line"><span class="string">            public class &#123;&#123;AttributeName&#125;&#125; : System.Attribute</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                public string Description &#123; get; &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">                public FunctionAttribute(string description)</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                    Description = description;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>and a method generating a new source file <code>FunctionAttribute.g.cs</code> with the <code>FunctionAttribute</code> source code.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddMarkerAttributeToCompilation</span>(<span class="params">IncrementalGeneratorInitializationContext context</span>)</span> </span><br><span class="line">&#123;</span><br><span class="line">    context.RegisterPostInitializationOutput(ctx =&gt; ctx.AddSource(</span><br><span class="line">        <span class="string">&quot;FunctionAttribute.g.cs&quot;</span>,</span><br><span class="line">        SourceText.From(AttributeSourceCode, Encoding.UTF8)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We do the same for <code>FunctionDetails</code> and <code>FunctionParameters</code> records.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*lang=cs*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> FunctionDetailsSourceCode = </span><br><span class="line">    $<span class="string">$&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        // &lt;auto-generated/&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        namespace &#123;&#123;Namespace&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            public record FunctionDetails(</span></span><br><span class="line"><span class="string">                [property: JsonPropertyName(&quot;</span>name<span class="string">&quot;)] string Name,</span></span><br><span class="line"><span class="string">                [property: JsonPropertyName(&quot;</span>parameters<span class="string">&quot;)] FunctionParameters FunctionParameters,</span></span><br><span class="line"><span class="string">                string Description</span></span><br><span class="line"><span class="string">            );</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*lang=cs*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> FunctionParametersSourceCode = </span><br><span class="line">    $<span class="string">$&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        // &lt;auto-generated/&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        namespace &#123;&#123;Namespace&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">        public record FunctionParameters([property: JsonPropertyName(&quot;</span>city<span class="string">&quot;)] string City);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddFunctionDetailsToCompilation</span>(<span class="params">IncrementalGeneratorInitializationContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    context.RegisterPostInitializationOutput(ctx =&gt; ctx.AddSource(</span><br><span class="line">        <span class="string">&quot;FunctionDetails.g.cs&quot;</span>,</span><br><span class="line">        SourceText.From(FunctionDetailsSourceCode, Encoding.UTF8)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddFunctionParametersToCompilation</span>(<span class="params">IncrementalGeneratorInitializationContext context</span>)</span>  </span><br><span class="line">&#123;</span><br><span class="line">    context.RegisterPostInitializationOutput(ctx =&gt; ctx.AddSource(</span><br><span class="line">        <span class="string">&quot;FunctionParameters.g.cs&quot;</span>,</span><br><span class="line">        SourceText.From(FunctionParametersSourceCode, Encoding.UTF8)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It is time to implement <code>void Initialize(IncrementalGeneratorInitializationContext context)</code> from <code>IIncrementalGenerator</code> interface. It will add the <code>FunctionAttribute</code>, <code>FunctionDetails</code>, and <code>FunctionParameters</code> to the compilation. Then it will get all methods decorated with the <code>FunctionAttribute</code> and generate the source code.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">IncrementalGeneratorInitializationContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    AddMarkerAttributeToCompilation(context);</span><br><span class="line">    AddFunctionDetailsToCompilation(context);</span><br><span class="line">    AddFunctionParametersToCompilation(context);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// üëáüèº Filter classes annotated with the [Function] attribute. Only filtered Syntax Nodes can trigger code generation.  </span></span><br><span class="line">    <span class="keyword">var</span> provider = context.SyntaxProvider</span><br><span class="line">        .CreateSyntaxProvider(</span><br><span class="line">            (s, _) =&gt; s <span class="keyword">is</span> MethodDeclarationSyntax,</span><br><span class="line">            (ctx, _) =&gt; GetMethodDeclarationForSourceGen(ctx))</span><br><span class="line">        .Where(t =&gt; t.functionAttributeFound)</span><br><span class="line">        .Select((t, _) =&gt; t.Item1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// üëáüèº Generate the source code.</span></span><br><span class="line">    context.RegisterSourceOutput(context.CompilationProvider.Combine(provider.Collect()),</span><br><span class="line">        (ctx, t) =&gt; GenerateCode(ctx, t.Left, t.Right));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We need to find the <code>MethodDeclarationSyntax</code> decorated with the <code>FunctionAttribute</code>.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> (<span class="params">MethodDeclarationSyntax, <span class="built_in">bool</span> functionAttributeFound</span>) <span class="title">GetMethodDeclarationForSourceGen</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    GeneratorSyntaxContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> methodDeclarationSyntax = (MethodDeclarationSyntax)context.Node;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// üëáüèº Go through all attributes of the class.</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> attributeListSyntax <span class="keyword">in</span> methodDeclarationSyntax.AttributeLists)</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> attributeSyntax <span class="keyword">in</span> attributeListSyntax.Attributes)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (context.SemanticModel.GetSymbolInfo(attributeSyntax).Symbol <span class="keyword">is</span> <span class="keyword">not</span> IMethodSymbol attributeSymbol)  </span><br><span class="line">            <span class="keyword">continue</span>; <span class="comment">// if we can&#x27;t get the symbol, ignore it</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> attributeName = attributeSymbol.ContainingType.ToDisplayString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// üëáüèº Check the full name of the [Function] attribute.</span></span><br><span class="line">        <span class="keyword">if</span> (attributeName == <span class="string">$&quot;<span class="subst">&#123;Namespace&#125;</span>.<span class="subst">&#123;AttributeName&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> (methodDeclarationSyntax, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (methodDeclarationSyntax, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, we generate the source code for the partial <code>Functions</code> class.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateCode</span>(<span class="params">SourceProductionContext context,</span></span></span><br><span class="line"><span class="params"><span class="function">                                 ImmutableArray&lt;MethodDeclarationSyntax&gt; methodDeclarations</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> partialClassName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (methodDeclarations.First().Parent <span class="keyword">is</span> ClassDeclarationSyntax classDeclarationSyntax)</span><br><span class="line">        partialClassName = classDeclarationSyntax.Identifier.Text;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> (functionNamePatternMatching, functionDetails) =</span><br><span class="line">        GenerateFunctionDetails(methodDeclarations);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*lang=cs*/</span></span><br><span class="line">    <span class="keyword">var</span> partialClassCode =</span><br><span class="line">        $$<span class="string">$&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">            // &lt;auto-generated/&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            using System;</span></span><br><span class="line"><span class="string">            using System.Collections.Generic;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            partial class &#123;&#123;&#123;partialClassName&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                public string Execute(FunctionDetails? function)</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                    return function?.Name switch </span></span><br><span class="line"><span class="string">                    &#123;</span></span><br><span class="line"><span class="string">                        &#123;&#123;&#123;functionNamePatternMatching&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">                    &#125;;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                public List&lt;FunctionDetails&gt; GetFunctionDetails() =&gt;</span></span><br><span class="line"><span class="string">                [</span></span><br><span class="line"><span class="string">                    &#123;&#123;&#123;functionDetails&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">                ];</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;</span><span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add the source code to the compilation.</span></span><br><span class="line">    context.AddSource(<span class="string">$&quot;<span class="subst">&#123;partialClassName&#125;</span>.g.cs&quot;</span>, </span><br><span class="line">                      SourceText.From(partialClassCode, Encoding.UTF8));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To generate the code we need to extract the function descriptions and names.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;(<span class="built_in">string</span> name, <span class="built_in">string</span> description)&gt; ExtractFunctionDescriptions(</span><br><span class="line">    ImmutableArray&lt;MethodDeclarationSyntax&gt; methodDeclarations)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> functionNames = <span class="keyword">new</span> List&lt;(<span class="built_in">string</span> name, <span class="built_in">string</span> description)&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Go through all filtered method declarations.</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> methodDeclarationSyntax <span class="keyword">in</span> methodDeclarations)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// üëáüèº Get attribute property called Function from methodDeclarationSyntax</span></span><br><span class="line">        <span class="keyword">var</span> attributeSyntax = methodDeclarationSyntax.AttributeLists</span><br><span class="line">            .SelectMany(x =&gt; x.Attributes)</span><br><span class="line">            .First(x =&gt; x.Name.ToString() == <span class="string">&quot;Function&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> descriptionArgument = attributeSyntax.ArgumentList?.Arguments.First();</span><br><span class="line">        <span class="keyword">if</span> (descriptionArgument == <span class="literal">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// üëáüèº Get attribute Description property</span></span><br><span class="line">        <span class="keyword">var</span> descriptionLiteral = (LiteralExpressionSyntax)descriptionArgument.Expression;</span><br><span class="line">        <span class="keyword">var</span> descriptionValue = descriptionLiteral.Token.ValueText;</span><br><span class="line"></span><br><span class="line">        functionNames.Add(</span><br><span class="line">            <span class="keyword">new</span> ValueTuple&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;(methodDeclarationSyntax.Identifier.Text, descriptionValue));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> functionNames;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And create the function details and function name pattern matching.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> (<span class="params">StringBuilder functionNamePatternMatching, StringBuilder functionDetails</span>) <span class="title">GenerateFunctionDetails</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    ImmutableArray&lt;MethodDeclarationSyntax&gt; methodDeclarations</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    StringBuilder functionNamePatternMatching = <span class="keyword">new</span>();</span><br><span class="line">    StringBuilder functionDetails = <span class="keyword">new</span>();</span><br><span class="line"></span><br><span class="line">    List&lt;(<span class="built_in">string</span> name, <span class="built_in">string</span> description)&gt; functionNames = ExtractFunctionDescriptions(methodDeclarations); </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; functionNames.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> functionNamesIndex = functionNames.Count - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">var</span> separator = i &lt; functionNamesIndex ? <span class="string">&quot;,&quot;</span> : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> indentFunctionName = i &lt; functionNamesIndex ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;             &quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> indentFunctionDetails = i &lt; functionNamesIndex ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;        &quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> newLine = i &lt; functionNamesIndex ? <span class="string">&quot;\n&quot;</span> : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        functionNamePatternMatching.Append(</span><br><span class="line">            <span class="string">$&quot;<span class="subst">&#123;indentFunctionName&#125;</span>\&quot;<span class="subst">&#123;functionNames[i].name&#125;</span>\&quot; =&gt; <span class="subst">&#123;functionNames[i].name&#125;</span>(function.FunctionParameters.City)<span class="subst">&#123;separator&#125;</span><span class="subst">&#123;newLine&#125;</span>&quot;</span>);  </span><br><span class="line">        functionDetails.Append(</span><br><span class="line">            <span class="string">$&quot;<span class="subst">&#123;indentFunctionDetails&#125;</span>new(\&quot;<span class="subst">&#123;functionNames[i].name&#125;</span>\&quot;, new FunctionParameters(\&quot;city\&quot;), \&quot;<span class="subst">&#123;functionNames[i].description&#125;</span>\&quot;)<span class="subst">&#123;separator&#125;</span><span class="subst">&#123;newLine&#125;</span>&quot;</span>);  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (functionNamePatternMatching, functionDetails);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h1><p>From our function declaration</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// üëáüèº Partial class annotated with the [Function] attribute used to generate functions.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">Functions</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Function(<span class="string">&quot;Get the current time for a city&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">GetCurrentTime</span>(<span class="params"><span class="built_in">string</span> city</span>)</span> =&gt;</span><br><span class="line">        <span class="string">$&quot;It is <span class="subst">&#123;DateTime.Now.Hour&#125;</span>:<span class="subst">&#123;DateTime.Now.Minute&#125;</span> in <span class="subst">&#123;city&#125;</span>.&quot;</span>;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Function(<span class="string">&quot;Get the current weather for a city&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">GetCurrentWeather</span>(<span class="params"><span class="built_in">string</span> city</span>)</span> =&gt;</span><br><span class="line">        <span class="string">&quot;The weather in &quot;</span> + city + <span class="string">&quot; is sunny.&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We generate the following code</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;auto-generated/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">Functions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Execute</span>(<span class="params">FunctionDetails? function</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> function?.Name <span class="keyword">switch</span> </span><br><span class="line">        &#123;</span><br><span class="line">             <span class="string">&quot;GetCurrentTime&quot;</span> =&gt; GetCurrentTime(function.FunctionParameters.City),</span><br><span class="line">             <span class="string">&quot;GetCurrentWeather&quot;</span> =&gt; GetCurrentWeather(function.FunctionParameters.City)</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;FunctionDetails&gt; <span class="title">GetFunctionDetails</span>()</span> =&gt;</span><br><span class="line">    [</span><br><span class="line">        <span class="keyword">new</span>(<span class="string">&quot;GetCurrentTime&quot;</span>, <span class="keyword">new</span> FunctionParameters(<span class="string">&quot;city&quot;</span>), <span class="string">&quot;Get the current time for a city&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span>(<span class="string">&quot;GetCurrentWeather&quot;</span>, <span class="keyword">new</span> FunctionParameters(<span class="string">&quot;city&quot;</span>), <span class="string">&quot;Get the current weather for a city&quot;</span>)  </span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>AI function&#x2F;tool calling is a powerful tool that allows AI models to interact with external tools and APIs, enabling them to perform complex tasks that require real-time data or specific computations. By understanding the core concepts and setting up your environment correctly, you can easily integrate AI-driven functionality into your C# projects, enhancing their capabilities.</p>
<p>I hope this tutorial has provided you with a clear understanding of AI function calling in C# and how you can get started with it.</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/awaescher/OllamaSharp">OllamaSharp</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ollama.com/">Ollama</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ollama.com/blog/tool-support">Ollama Tool support</a></li>
<li><a target="_blank" rel="noopener" href="https://ai.meta.com/blog/llama-3-2-connect-2024-vision-edge-mobile-devices/">Llama 3.2 SLM</a></li>
<li><a target="_blank" rel="noopener" href="https://andrewlock.net/creating-a-source-generator-part-1-creating-an-incremental-source-generator/">Creating an incremental generator</a></li>
<li><a target="_blank" rel="noopener" href="https://www.pluralsight.com/courses/c-sharp-10-developing-source-generators">Developing Source Generators in C#</a></li>
</ul>
<p>Get the source code on GitHub <a target="_blank" rel="noopener" href="https://github.com/laurentkempe/aiPlayground/tree/main/OllamaToolConsoleApp">laurentkempe&#x2F;aiPlayground&#x2F;OllamaToolConsoleApp</a>.</p>
<p></p>
<div style="text-align: left">
  <div class="github-card"
    data-user="laurentkempe"
    data-repo="aiPlayground"
    data-height="200"
    data-width="400"
    data-theme="default"
    data-target=""
    data-client-id=""
    data-client-secret=""
  ></div>
</div>
<script src="/github-card-lib/githubcard.js"></script>



            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/AI/" rel="tag">AI</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/C/" rel="tag">C#</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/LLM/" rel="tag">LLM</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Ollama/" rel="tag">Ollama</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/SLM/" rel="tag">SLM</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2025/01/27/leveraging-microsoftextensionsai-for-tool-calling-in-csharp/"
                    data-tooltip="Leveraging Microsoft.Extensions.AI for Tool Calling in C#"
                    aria-label="PREVIOUS: Leveraging Microsoft.Extensions.AI for Tool Calling in C#"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2024/05/01/run-phi-3-slm-on-your-machine-with-csharp-semantic-kernel-and-ollama/"
                    data-tooltip="Run Phi-3 SLM on your machine with C# Semantic Kernel and Ollama"
                    aria-label="NEXT: Run Phi-3 SLM on your machine with C# Semantic Kernel and Ollama"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://laurentkempe.com/2024/10/28/learning-ai-function-calling-in-csharp-with-llama-32-slm-and-ollama-running-on-your-machine/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://laurentkempe.com/2024/10/28/learning-ai-function-calling-in-csharp-with-llama-32-slm-and-ollama-running-on-your-machine/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://laurentkempe.com/2024/10/28/learning-ai-function-calling-in-csharp-with-llama-32-slm-and-ollama-running-on-your-machine/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Laurent Kemp√©. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2025/01/27/leveraging-microsoftextensionsai-for-tool-calling-in-csharp/"
                    data-tooltip="Leveraging Microsoft.Extensions.AI for Tool Calling in C#"
                    aria-label="PREVIOUS: Leveraging Microsoft.Extensions.AI for Tool Calling in C#"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2024/05/01/run-phi-3-slm-on-your-machine-with-csharp-semantic-kernel-and-ollama/"
                    data-tooltip="Run Phi-3 SLM on your machine with C# Semantic Kernel and Ollama"
                    aria-label="NEXT: Run Phi-3 SLM on your machine with C# Semantic Kernel and Ollama"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://laurentkempe.com/2024/10/28/learning-ai-function-calling-in-csharp-with-llama-32-slm-and-ollama-running-on-your-machine/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://laurentkempe.com/2024/10/28/learning-ai-function-calling-in-csharp-with-llama-32-slm-and-ollama-running-on-your-machine/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://laurentkempe.com/2024/10/28/learning-ai-function-calling-in-csharp-with-llama-32-slm-and-ollama-running-on-your-machine/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://laurentkempe.com/2024/10/28/learning-ai-function-calling-in-csharp-with-llama-32-slm-and-ollama-running-on-your-machine/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://laurentkempe.com/2024/10/28/learning-ai-function-calling-in-csharp-with-llama-32-slm-and-ollama-running-on-your-machine/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://laurentkempe.com/2024/10/28/learning-ai-function-calling-in-csharp-with-llama-32-slm-and-ollama-running-on-your-machine/"
                        aria-label="global.share_on_linkedin"
                    >
                        <i class="fab fa-linkedin" aria-hidden="true"></i><span>global.share_on_linkedin</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://farm2.staticflickr.com/1971/31306281378_02b055ccfe_q.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Laurent Kemp√©</h4>
        
            <div id="about-card-bio"><p>I am an experienced Team Leader &amp; Distinguished Solution Architect with a passion for shipping high-quality products by empowering development team and culture toward an agile mindset. I bring technical vision and strategy, leading engineering teams to move product, processes and architecture forward.</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Team Leader, Distinguished Solutions Architect</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Illzach, France
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('https://farm5.staticflickr.com/4437/37116073235_dda239221d_o.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-2svoout4e47fde7ju7chy0ibhaowroxdauecuuahzjvewdookbc009v6s0zq.min.js"></script>

<!--SCRIPTS END-->



    




    </body>
</html>
